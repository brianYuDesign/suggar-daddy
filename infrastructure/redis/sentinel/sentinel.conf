# ====================================================================
# Redis Sentinel Configuration
# ====================================================================
# Redis Sentinel 提供高可用性解決方案
# 主要功能：
# 1. 監控 (Monitoring)：持續檢查 Master 和 Replica 是否正常運作
# 2. 通知 (Notification)：當 Redis 實例出現問題時通知管理員
# 3. 自動故障轉移 (Automatic failover)：當 Master 下線時自動提升 Replica
# 4. 配置提供者 (Configuration provider)：客戶端連接 Sentinel 來發現當前的 Master

# ── 基本設定 ────────────────────────────────────────────────────────
# Sentinel 端口
port 26379

# 綁定所有網卡
bind 0.0.0.0

# 保護模式關閉
protected-mode no

# 工作目錄
dir /tmp

# ── 監控設定 ────────────────────────────────────────────────────────
# 監控 Master
# 格式：sentinel monitor <master-name> <ip> <port> <quorum>
# 
# master-name: Master 的名稱（客戶端會用這個名稱來查詢）
# ip: Master 的 IP 或主機名
# port: Master 的端口
# quorum: 判定 Master 主觀下線所需的 Sentinel 數量
#
# quorum = 2 意味著至少需要 2 個 Sentinel 同意 Master 已下線
# 才會啟動故障轉移流程
sentinel monitor mymaster redis-master 6379 2

# ── 故障判定時間設定 ────────────────────────────────────────────────
# Master 被視為主觀下線的時間（毫秒）
# 如果 Sentinel 在這段時間內無法與 Master 通訊，則判定為主觀下線
# 預設 30 秒，這裡設為 5 秒以加快故障檢測
sentinel down-after-milliseconds mymaster 5000

# ── 故障轉移設定 ────────────────────────────────────────────────────
# 故障轉移超時時間（毫秒）
# 如果故障轉移在這個時間內未完成，將被視為失敗
# 這個值應該大於 down-after-milliseconds
sentinel failover-timeout mymaster 10000

# 並行同步的 Replica 數量
# 在故障轉移期間，有多少個 Replica 可以同時向新 Master 同步
# 設為 1 可以確保一次只有一個 Replica 在重新同步，減少負載
# 設為更大的值可以加快故障轉移速度，但會增加 Master 負載
sentinel parallel-syncs mymaster 1

# ── Sentinel 通訊設定 ────────────────────────────────────────────────
# Sentinel 之間的通訊超時時間（毫秒）
# 用於 Sentinel 之間的互相發現和投票
# sentinel sentinel-down-after-milliseconds 30000

# ── 腳本執行設定 ────────────────────────────────────────────────────
# 當發生故障轉移時可以執行自定義腳本
# 例如：通知管理員、更新 DNS、重新配置負載均衡器等

# 通知腳本（可選）
# sentinel notification-script mymaster /path/to/notification-script.sh

# 客戶端重新配置腳本（可選）
# sentinel client-reconfig-script mymaster /path/to/reconfig-script.sh

# ── 日誌設定 ────────────────────────────────────────────────────────
# 日誌級別：debug, verbose, notice, warning
loglevel notice

# 日誌文件（空字符串表示輸出到標準輸出）
logfile ""

# ── 其他設定 ────────────────────────────────────────────────────────
# 是否總是顯示 logo
always-show-logo no

# ====================================================================
# 重要提醒
# ====================================================================
# 1. 生產環境中至少需要 3 個 Sentinel 實例
#    - 保證高可用性和正確的投票機制
#    - 避免腦裂（split-brain）問題
#
# 2. quorum 的選擇
#    - 對於 3 個 Sentinel，quorum = 2 是最佳選擇
#    - quorum 應該是 (sentinels數量 / 2) + 1
#    - 太低可能導致誤判，太高可能導致無法故障轉移
#
# 3. Sentinel 應該部署在不同的物理機器上
#    - 避免單點故障
#    - 本地開發環境可以在同一台機器上運行
#
# 4. down-after-milliseconds 的選擇
#    - 太短可能導致誤判（網路抖動）
#    - 太長會延遲故障轉移時間
#    - 生產環境建議 30000-60000（30-60秒）
#    - 開發環境可以設置較短的時間以便測試
#
# 5. 這個配置文件會被 Sentinel 動態修改
#    - Sentinel 會在運行時添加其他 Sentinel 的信息
#    - Sentinel 會更新 Master 的 IP 和端口（故障轉移後）
#    - 因此這個文件需要有寫入權限
# ====================================================================
