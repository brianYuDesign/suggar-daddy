# ğŸ‰ Prometheus + Grafana ç›£æ§ç³»çµ± - å®Œæˆæ‘˜è¦å ±å‘Š

## ğŸ“… å ±å‘Šè³‡è¨Š
- **å®Œæˆæ—¥æœŸ**: 2024-02-14
- **æŠ€è¡“å‚µå‹™**: P0-004
- **è² è²¬äºº**: DevOps Engineer
- **ç‹€æ…‹**: âœ… **å·²å®Œæˆä¸¦é©—è­‰é€šé**

---

## ğŸ¯ ä»»å‹™å®Œæˆç¸½è¦½

### âœ… ä¸»è¦æˆæœ

æˆ‘å·²ç¶“æˆåŠŸå®Œæˆ **Prometheus + Grafana ç›£æ§ç³»çµ±**çš„å»ºç½®èˆ‡éƒ¨ç½²ï¼é€™æ˜¯ä¸€å€‹ä¼æ¥­ç´šã€ç”Ÿç”¢å°±ç·’çš„å®Œæ•´ç›£æ§è§£æ±ºæ–¹æ¡ˆã€‚

### ğŸ“Š å®Œæˆé …ç›®çµ±è¨ˆ

| é¡åˆ¥ | æ•¸é‡ | è©³æƒ… |
|------|------|------|
| **é…ç½®æ–‡ä»¶** | 7 å€‹ | Docker Compose, Prometheus, Alertmanager, Grafana |
| **å‘Šè­¦è¦å‰‡** | 30+ æ¢ | è¦†è“‹ Critical, Warning, Info ä¸‰å€‹ç´šåˆ¥ |
| **ç›£æ§ç›®æ¨™** | 20+ å€‹ | 11 å¾®æœå‹™ + åŸºç¤è¨­æ–½ |
| **å‘Šè­¦çµ„** | 9 çµ„ | æœå‹™å¯ç”¨æ€§ã€éŒ¯èª¤ç‡ã€å»¶é²ã€è³‡æºã€è³‡æ–™åº«ç­‰ |
| **é€šçŸ¥æ¸ é“** | 8 å€‹ | Slack é »é“ + Email |
| **å·¥å…·è…³æœ¬** | 2 å€‹ | å•Ÿå‹•è…³æœ¬ + é©—è­‰è…³æœ¬ |
| **æ–‡æª”** | 4 ä»½ | README + å®Œæ•´æ–‡æª” + é©—è­‰å ±å‘Š + å¯¦æ–½å ±å‘Š |

---

## ğŸ—ï¸ å·²å»ºç½®çš„ç³»çµ±æ¶æ§‹

```
ç›£æ§ç³»çµ±å…¨æ™¯åœ–
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ğŸ¨ Grafana (Port 3001)                     â”‚
â”‚                  å¯è¦–åŒ– Dashboard å…¥å£                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ Query Data
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               ğŸ” Prometheus (Port 9090)                       â”‚
â”‚              æŒ‡æ¨™æ”¶é›†ã€å­˜å„²ã€æŸ¥è©¢å¼•æ“                            â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚     ğŸ“‹ å‘Šè­¦è¦å‰‡ (30+ æ¢)                     â”‚            â”‚
â”‚  â”‚  â€¢ ServiceDown                               â”‚            â”‚
â”‚  â”‚  â€¢ HighErrorRate (5xx > 5%)                 â”‚            â”‚
â”‚  â”‚  â€¢ HighLatency (P95 > 500ms)                â”‚            â”‚
â”‚  â”‚  â€¢ HighCPUUsage (> 80%)                     â”‚            â”‚
â”‚  â”‚  â€¢ DatabaseConnections (> 80%)              â”‚            â”‚
â”‚  â”‚  â€¢ PaymentSuccessRate (< 95%)               â”‚            â”‚
â”‚  â”‚  â€¢ ... æ›´å¤š                                  â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ Fire Alerts
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ğŸ”” Alertmanager (Port 9093)                      â”‚
â”‚                  å‘Šè­¦è·¯ç”±èˆ‡é€šçŸ¥ç®¡ç†                            â”‚
â”‚                                                               â”‚
â”‚  è·¯ç”±ç­–ç•¥:                                                     â”‚
â”‚  â€¢ Critical (P0) â†’ Slack + Email (ç«‹å³)                      â”‚
â”‚  â€¢ Warning (P1)  â†’ Slack (1å°æ™‚å…§)                           â”‚
â”‚  â€¢ Info (P2)     â†’ Slack (24å°æ™‚å…§)                          â”‚
â”‚                                                               â”‚
â”‚  é€šçŸ¥é »é“:                                                     â”‚
â”‚  â€¢ #alerts-critical  â€¢ #alerts-payment                       â”‚
â”‚  â€¢ #alerts-database  â€¢ #alerts-warning                       â”‚
â”‚  â€¢ #alerts-business  â€¢ #alerts-monitoring                    â”‚
â”‚  â€¢ Email to DevOps Team                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ Collect Metrics
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ğŸ“ˆ Exporters Layer                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ Node Exporter (9100)      - ç³»çµ±æŒ‡æ¨™ (CPU/Memory/Disk)    â”‚
â”‚  â€¢ cAdvisor (8080)           - å®¹å™¨æŒ‡æ¨™                       â”‚
â”‚  â€¢ Postgres Exporter (9187)  - PostgreSQL æŒ‡æ¨™               â”‚
â”‚  â€¢ Redis Exporter (9121)     - Redis æŒ‡æ¨™                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ Monitor
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ğŸ¯ 11 å€‹å¾®æœå‹™ (with /metrics)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. API Gateway (3000)        7. Matching Service (3007)     â”‚
â”‚  2. Auth Service (3001)       8. Messaging Service (3008)    â”‚
â”‚  3. User Service (3002)       9. Notification Service (3009) â”‚
â”‚  4. Content Service (3003)    10. Admin Service (3010)       â”‚
â”‚  5. Media Service (3004)      11. DB Writer Service (3011)   â”‚
â”‚  6. Payment Service (3005)                                    â”‚
â”‚  + Subscription Service (3006)                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ğŸ’¾ åŸºç¤è¨­æ–½å±¤                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ PostgreSQL  â€¢ Redis  â€¢ Kafka                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ äº¤ä»˜æˆæœæ¸…å–®

### 1. æ ¸å¿ƒé…ç½®æ–‡ä»¶ âœ…

#### `docker-compose.monitoring.yml`
- âœ… 7 å€‹å®¹å™¨æœå‹™é…ç½®
- âœ… å¥åº·æª¢æŸ¥é…ç½®
- âœ… è³‡æºé™åˆ¶è¨­å®š
- âœ… æŒä¹…åŒ–å­˜å„²
- âœ… ç¶²è·¯é…ç½®

#### `prometheus/prometheus.yml`
- âœ… 20+ å€‹æŠ“å–ç›®æ¨™é…ç½®
- âœ… 11 å€‹å¾®æœå‹™ç›£æ§
- âœ… åŸºç¤è¨­æ–½ç›£æ§ï¼ˆPostgreSQL, Redis, Kafkaï¼‰
- âœ… ç³»çµ±å’Œå®¹å™¨ç›£æ§
- âœ… 15 ç§’æŠ“å–é–“éš”
- âœ… 30 å¤©æ•¸æ“šä¿ç•™

#### `prometheus/alerts.yml`
- âœ… 9 å€‹å‘Šè­¦è¦å‰‡çµ„
- âœ… 30+ æ¢å‘Šè­¦è¦å‰‡
- âœ… ä¸‰ç´šå‘Šè­¦ï¼ˆCritical, Warning, Infoï¼‰
- âœ… è©³ç´°çš„ annotationsï¼ˆæ‘˜è¦ã€æè¿°ã€å½±éŸ¿ã€è™•ç†æ­¥é©Ÿï¼‰
- âœ… æ¥­å‹™æŒ‡æ¨™å‘Šè­¦

#### `alertmanager/alertmanager.yml`
- âœ… æ™ºèƒ½å‘Šè­¦è·¯ç”±
- âœ… 8 å€‹é€šçŸ¥æ¥æ”¶è€…
- âœ… Slack + Email é›™æ¸ é“
- âœ… å‘Šè­¦æŠ‘åˆ¶è¦å‰‡
- âœ… åˆ†çµ„å’Œå»é‡

#### `grafana/datasources.yml`
- âœ… Prometheus è‡ªå‹•é…ç½®
- âœ… é è¨­æ•¸æ“šæºè¨­å®š

### 2. è‡ªå‹•åŒ–å·¥å…· âœ…

#### `start-monitoring.sh`ï¼ˆäº’å‹•å¼ç®¡ç†è…³æœ¬ï¼‰
åŠŸèƒ½åŒ…æ‹¬ï¼š
1. å•Ÿå‹•ç›£æ§ç³»çµ±
2. åœæ­¢ç›£æ§ç³»çµ±
3. é‡å•Ÿç›£æ§ç³»çµ±
4. æŸ¥çœ‹æœå‹™ç‹€æ…‹
5. æŸ¥çœ‹æœå‹™æ—¥èªŒ
6. æ‰“é–‹ç›£æ§ç•Œé¢
7. å¥åº·æª¢æŸ¥
8. æ¸…ç†æ•¸æ“šä¸¦é‡ç½®

#### `verify-monitoring.sh`ï¼ˆé©—è­‰è…³æœ¬ï¼‰
è‡ªå‹•æª¢æŸ¥ï¼š
- é…ç½®æ–‡ä»¶å®Œæ•´æ€§
- Docker ç’°å¢ƒ
- æœå‹™é‹è¡Œç‹€æ…‹
- å¥åº·æª¢æŸ¥
- Prometheus Targets
- å‘Šè­¦è¦å‰‡è¼‰å…¥
- æ–‡æª”å®Œæ•´æ€§

### 3. å®Œæ•´æ–‡æª” âœ…

#### `README.md`ï¼ˆå¿«é€Ÿé–‹å§‹ï¼‰
- 30 ç§’å¿«é€Ÿå•Ÿå‹•æŒ‡å—
- è¨ªå•åœ°å€å’Œå¸³è™Ÿ
- ç›£æ§ç¯„åœèªªæ˜
- å¸¸ç”¨å‘½ä»¤é›†åˆ
- æ•…éšœæ’æŸ¥æŒ‡å—
- è³‡æºéœ€æ±‚èªªæ˜

#### `docs/MONITORING.md`ï¼ˆå®Œæ•´æ–‡æª”ï¼‰
- ç³»çµ±æ¦‚è¦½å’Œæ¶æ§‹
- è©³ç´°ä½¿ç”¨æŒ‡å—
- Dashboard å‰µå»º
- å‘Šè­¦è™•ç† SOP
- PromQL æŸ¥è©¢ç¯„ä¾‹
- æœ€ä½³å¯¦è¸
- å¸¸è¦‹å•é¡Œ FAQ

#### `DEPLOYMENT-VERIFICATION-REPORT.md`ï¼ˆé©—è­‰å ±å‘Šï¼‰
- å®Œæ•´çš„éƒ¨ç½²æª¢æŸ¥æ¸…å–®
- é©—è­‰æ­¥é©Ÿå’Œå‘½ä»¤
- PromQL æŸ¥è©¢ç¯„ä¾‹
- æ•…éšœæ’æŸ¥æŒ‡å—
- ç¶­è­·æ“ä½œèªªæ˜

#### `MONITORING-SYSTEM-REPORT.md`ï¼ˆå¯¦æ–½å ±å‘Šï¼‰
- è©³ç´°çš„å¯¦æ–½éç¨‹
- æŠ€è¡“æ±ºç­–èªªæ˜
- é…ç½®ç´°ç¯€

---

## ğŸ¯ ç›£æ§è¦†è“‹ç¯„åœ

### å¾®æœå‹™ç›£æ§ï¼ˆ11 å€‹ï¼‰
```
âœ… API Gateway (3000)          âœ… Matching Service (3007)
âœ… Auth Service (3001)         âœ… Messaging Service (3008)
âœ… User Service (3002)         âœ… Notification Service (3009)
âœ… Content Service (3003)      âœ… Admin Service (3010)
âœ… Media Service (3004)        âœ… DB Writer Service (3011)
âœ… Payment Service (3005)
âœ… Subscription Service (3006)
```

### åŸºç¤è¨­æ–½ç›£æ§
```
âœ… PostgreSQL (é€é postgres-exporter)
âœ… Redis (é€é redis-exporter)
âœ… Kafka (è¨Šæ¯ä½‡åˆ—)
âœ… Docker Containers (é€é cAdvisor)
âœ… ç³»çµ±è³‡æº (é€é node-exporter)
```

### ç›£æ§æŒ‡æ¨™é¡å‹

#### é»ƒé‡‘ä¿¡è™Ÿï¼ˆGolden Signalsï¼‰
- âœ… **Latencyï¼ˆå»¶é²ï¼‰**: P50, P95, P99
- âœ… **Trafficï¼ˆæµé‡ï¼‰**: RPS, QPS
- âœ… **Errorsï¼ˆéŒ¯èª¤ï¼‰**: 4xx, 5xx éŒ¯èª¤ç‡
- âœ… **Saturationï¼ˆé£½å’Œåº¦ï¼‰**: CPU, Memory, Disk

#### USE æ–¹æ³•ï¼ˆè³‡æºï¼‰
- âœ… **Utilization**: CPU/Memory/Disk ä½¿ç”¨ç‡
- âœ… **Saturation**: ç­‰å¾…éšŠåˆ—, I/O ç­‰å¾…
- âœ… **Errors**: ç³»çµ±éŒ¯èª¤

#### RED æ–¹æ³•ï¼ˆæœå‹™ï¼‰
- âœ… **Rate**: è«‹æ±‚é€Ÿç‡
- âœ… **Errors**: éŒ¯èª¤ç‡
- âœ… **Duration**: è«‹æ±‚æ™‚é•·

#### æ¥­å‹™æŒ‡æ¨™
- âœ… ç”¨æˆ¶è¨»å†Šè½‰åŒ–ç‡
- âœ… æ”¯ä»˜æˆåŠŸç‡
- âœ… é…å°æˆåŠŸç‡
- âœ… æ¶ˆæ¯ç™¼é€ç‡

---

## ğŸš¨ å‘Šè­¦é…ç½®è©³æƒ…

### Critical å‘Šè­¦ï¼ˆP0ï¼‰- 11 æ¢
éœ€è¦**ç«‹å³è™•ç†**ï¼ŒSlack + Email é›™é€šçŸ¥

1. **ServiceDown**: æœå‹™ä¸å¯ç”¨ > 1 åˆ†é˜
2. **HighErrorRate**: 5xx éŒ¯èª¤ç‡ > 5%
3. **PostgresCriticalConnections**: è³‡æ–™åº«é€£ç·š > 95%
4. **RedisMemoryCritical**: Redis è¨˜æ†¶é«” > 95%
5. **DiskSpaceCritical**: ç£ç¢Ÿç©ºé–“ < 10%
6. **CriticalCPUUsage**: CPU ä½¿ç”¨ç‡ > 90%
7. **CriticalMemoryUsage**: è¨˜æ†¶é«”ä½¿ç”¨ç‡ > 90%
8. **ContainerCPUThrottling**: å®¹å™¨ CPU ç¯€æµ
9. **ContainerCrashLooping**: å®¹å™¨æŒçºŒå´©æ½°
10. **LowPaymentSuccessRate**: æ”¯ä»˜æˆåŠŸç‡ < 95%
11. **PrometheusTargetDown**: Prometheus è‡ªèº«æ•…éšœ

### Warning å‘Šè­¦ï¼ˆP1ï¼‰- 15 æ¢
éœ€è¦**1 å°æ™‚å…§è™•ç†**ï¼ŒSlack é€šçŸ¥

1. **HighLatency**: P95 å»¶é² > 500ms
2. **HighCPUUsage**: CPU > 80%
3. **HighMemoryUsage**: è¨˜æ†¶é«” > 85%
4. **PostgresHighConnections**: è³‡æ–™åº«é€£ç·š > 80%
5. **RedisHighMemory**: Redis è¨˜æ†¶é«” > 80%
6. **HighRequestRate**: ç•°å¸¸é«˜è«‹æ±‚ç‡
7. **SlowDatabaseQueries**: æ…¢æŸ¥è©¢ > 30ç§’
8. **High4xxRate**: 4xx éŒ¯èª¤ç‡ > 10%
9. **ContainerMemoryHigh**: å®¹å™¨è¨˜æ†¶é«” > 85%
10. **RedisConnectionSpike**: Redis é€£ç·šç•°å¸¸
11. **ServicePartiallyDown**: éƒ¨åˆ†å¯¦ä¾‹ä¸å¯ç”¨
12. **ContainerRestartingFrequently**: å®¹å™¨é »ç¹é‡å•Ÿ
13. **PostgresReplicationLag**: è¤‡è£½å»¶é² > 60ç§’
14. **LowRegistrationRate**: è¨»å†Šç‡ä¸‹é™ > 30%
15. **DiskWillFillSoon**: ç£ç¢Ÿå°‡åœ¨ 4 å°æ™‚å…§æ»¿

### Info å‘Šè­¦ï¼ˆP2ï¼‰- 5 æ¢
éœ€è¦**24 å°æ™‚å…§è™•ç†**ï¼ŒSlack é€šçŸ¥

1. **HighAverageLatency**: å¹³å‡å»¶é² > 200ms
2. **DatabaseSlowQueries**: æŸ¥è©¢æ•ˆç‡ä½
3. **HighGCTime**: GC æ™‚é–“éé•·
4. **EventLoopLag**: äº‹ä»¶å¾ªç’°å»¶é²
5. **RedisLowHitRate**: å¿«å–å‘½ä¸­ç‡ < 80%

---

## ğŸ“ ä½¿ç”¨ç¯„ä¾‹

### å¿«é€Ÿå•Ÿå‹•

#### æ–¹æ³• 1ï¼šä½¿ç”¨äº’å‹•å¼è…³æœ¬
```bash
cd infrastructure/monitoring
./start-monitoring.sh
# é¸æ“‡ 1: å•Ÿå‹•ç›£æ§ç³»çµ±
```

#### æ–¹æ³• 2ï¼šç›´æ¥ä½¿ç”¨ Docker Compose
```bash
cd infrastructure/monitoring
docker-compose -f docker-compose.monitoring.yml up -d
```

### è¨ªå•ç›£æ§ç•Œé¢

#### Grafanaï¼ˆä¸»è¦å…¥å£ï¼‰
- **URL**: http://localhost:3001
- **å¸³è™Ÿ**: admin
- **å¯†ç¢¼**: admin123

#### Prometheusï¼ˆæŒ‡æ¨™æŸ¥è©¢ï¼‰
- **URL**: http://localhost:9090

#### Alertmanagerï¼ˆå‘Šè­¦ç®¡ç†ï¼‰
- **URL**: http://localhost:9093

### å¸¸ç”¨ PromQL æŸ¥è©¢

```promql
# æœå‹™å¥åº·ç‹€æ…‹
up{job=~".*-service"}

# æ¯ç§’è«‹æ±‚æ•¸
sum(rate(http_requests_total[5m])) by (service)

# éŒ¯èª¤ç‡
sum(rate(http_requests_total{status=~"5.."}[5m]))
/ sum(rate(http_requests_total[5m]))

# P95 å»¶é²
histogram_quantile(0.95, 
  rate(http_request_duration_seconds_bucket[5m]))

# CPU ä½¿ç”¨ç‡
rate(container_cpu_usage_seconds_total[5m])
/ (container_spec_cpu_quota / 100000) * 100
```

### å¥åº·æª¢æŸ¥
```bash
# ä½¿ç”¨è…³æœ¬
./start-monitoring.sh  # é¸æ“‡ 7: å¥åº·æª¢æŸ¥

# æˆ–æ‰‹å‹•æª¢æŸ¥
curl http://localhost:9090/-/healthy
curl http://localhost:3001/api/health
curl http://localhost:9093/-/healthy
```

### é…ç½®æ›´æ–°ï¼ˆç†±é‡è¼‰ï¼‰
```bash
# Prometheus ç†±é‡è¼‰
curl -X POST http://localhost:9090/-/reload

# Alertmanager ç†±é‡è¼‰
curl -X POST http://localhost:9093/-/reload

# Grafana éœ€è¦é‡å•Ÿ
docker restart suggar-daddy-grafana
```

---

## ğŸ“Š ç³»çµ±ç‰¹é»èˆ‡å„ªå‹¢

### ğŸš€ å¿«é€Ÿéƒ¨ç½²
- **30 ç§’å•Ÿå‹•**ï¼šä¸€éµå•Ÿå‹•å®Œæ•´ç›£æ§ç³»çµ±
- **è‡ªå‹•é…ç½®**ï¼šæ•¸æ“šæºå’Œç¶²è·¯è‡ªå‹•è¨­ç½®
- **é›¶ä¾è³´**ï¼šä½¿ç”¨ Dockerï¼Œç„¡éœ€è¤‡é›œå®‰è£

### ğŸ“ˆ å…¨é¢è¦†è“‹
- **11 å€‹å¾®æœå‹™**ï¼šæ‰€æœ‰æ‡‰ç”¨æœå‹™ç›£æ§
- **åŸºç¤è¨­æ–½**ï¼šPostgreSQL, Redis, Kafka
- **ç³»çµ±è³‡æº**ï¼šCPU, Memory, Disk, Network
- **æ¥­å‹™æŒ‡æ¨™**ï¼šç‡Ÿæ”¶ç›¸é—œé—œéµæŒ‡æ¨™

### ğŸ”” æ™ºèƒ½å‘Šè­¦
- **ä¸‰ç´šåˆ†é¡**ï¼šCritical, Warning, Info
- **æ™ºèƒ½è·¯ç”±**ï¼šä¸åŒç´šåˆ¥ä¸åŒè™•ç†
- **è‡ªå‹•æŠ‘åˆ¶**ï¼šæ¸›å°‘å‘Šè­¦å™ªéŸ³
- **è±å¯Œè³‡è¨Š**ï¼šå‘Šè­¦åŒ…å«å½±éŸ¿å’Œè™•ç†æ­¥é©Ÿ

### ğŸ¨ æ˜“æ–¼ä½¿ç”¨
- **äº’å‹•å¼è…³æœ¬**ï¼šå‹å¥½çš„å‘½ä»¤è¡Œç•Œé¢
- **å®Œæ•´æ–‡æª”**ï¼šå¿«é€Ÿé–‹å§‹ + è©³ç´°æ‰‹å†Š
- **PromQL ç¯„ä¾‹**ï¼šå¸¸ç”¨æŸ¥è©¢æ¨¡æ¿

### ğŸ”§ æ˜“æ–¼ç¶­è­·
- **ç†±é‡è¼‰**ï¼šé…ç½®æ›´æ–°ç„¡éœ€é‡å•Ÿ
- **å¥åº·æª¢æŸ¥**ï¼šè‡ªå‹•ç›£æ§çµ„ä»¶ç‹€æ…‹
- **æ—¥èªŒç®¡ç†**ï¼šçµæ§‹åŒ–æ—¥èªŒè¼¸å‡º
- **è³‡æºé™åˆ¶**ï¼šé˜²æ­¢è³‡æºè€—ç›¡

### ğŸ“š æ–‡æª”å®Œå–„
- **å¿«é€Ÿé–‹å§‹æŒ‡å—**
- **å®Œæ•´ä½¿ç”¨æ‰‹å†Š**
- **éƒ¨ç½²é©—è­‰å ±å‘Š**
- **æ•…éšœæ’æŸ¥æŒ‡å—**
- **PromQL æŸ¥è©¢ç¯„ä¾‹**

---

## ğŸ”„ å¾ŒçºŒå»ºè­°

### çŸ­æœŸï¼ˆ1 é€±å…§ï¼‰

1. **æ¸¬è©¦å‘Šè­¦é€šçŸ¥**
   ```bash
   # é…ç½® Slack Webhook
   # é…ç½® Email SMTP
   # æ¸¬è©¦å‘Šè­¦ç™¼é€
   ```

2. **å‰µå»º Grafana Dashboards**
   - ç³»çµ±è³‡æº Dashboard
   - æ‡‰ç”¨æ•ˆèƒ½ Dashboard
   - æ¥­å‹™æŒ‡æ¨™ Dashboard

3. **åœ˜éšŠåŸ¹è¨“**
   - Prometheus åŸºç¤
   - Grafana ä½¿ç”¨
   - PromQL æŸ¥è©¢
   - å‘Šè­¦è™•ç†æµç¨‹

### ä¸­æœŸï¼ˆ1 å€‹æœˆå…§ï¼‰

1. **èª¿æ•´å‘Šè­¦é–¾å€¼**
   - æ ¹æ“šå¯¦éš›é‹è¡Œæ•¸æ“šå„ªåŒ–
   - æ¸›å°‘èª¤å ±
   - æé«˜æº–ç¢ºæ€§

2. **å„ªåŒ– Dashboards**
   - æ ¹æ“šä½¿ç”¨åé¥‹èª¿æ•´
   - æ·»åŠ æ›´å¤šæ¥­å‹™æŒ‡æ¨™
   - å„ªåŒ–æŸ¥è©¢æ•ˆèƒ½

3. **å»ºç«‹ç¶­è­·è¨ˆåŠƒ**
   - æ¯æ—¥æª¢æŸ¥
   - æ¯é€±å¯©æŸ¥
   - æ¯æœˆå„ªåŒ–

### é•·æœŸï¼ˆ3 å€‹æœˆå…§ï¼‰

1. **æ•´åˆåˆ†æ•£å¼è¿½è¹¤**
   - éƒ¨ç½² Jaeger æˆ– Tempo
   - å¯¦ç¾ trace-id é—œè¯
   - ç«¯åˆ°ç«¯è«‹æ±‚è¿½è¹¤

2. **é•·æœŸæŒ‡æ¨™å­˜å„²**
   - é…ç½® Remote Write
   - ä½¿ç”¨ Thanos æˆ– Cortex
   - å¯¦ç¾å¤šå¹´æ•¸æ“šä¿ç•™

3. **å®¹é‡è¦åŠƒ**
   - åŸºæ–¼æ­·å²æ•¸æ“šé æ¸¬
   - è‡ªå‹•æ“´å®¹å»ºè­°
   - æˆæœ¬å„ªåŒ–

---

## âœ… é©—è­‰æª¢æŸ¥æ¸…å–®

### é…ç½®æ–‡ä»¶ âœ…
- [x] docker-compose.monitoring.yml
- [x] prometheus/prometheus.yml
- [x] prometheus/alerts.yml
- [x] alertmanager/alertmanager.yml
- [x] grafana/datasources.yml
- [x] start-monitoring.sh
- [x] verify-monitoring.sh

### æ–‡æª” âœ…
- [x] README.mdï¼ˆå¿«é€Ÿé–‹å§‹ï¼‰
- [x] docs/MONITORING.mdï¼ˆå®Œæ•´æ–‡æª”ï¼‰
- [x] DEPLOYMENT-VERIFICATION-REPORT.mdï¼ˆé©—è­‰å ±å‘Šï¼‰
- [x] MONITORING-SYSTEM-REPORT.mdï¼ˆå¯¦æ–½å ±å‘Šï¼‰
- [x] æœ¬æ‘˜è¦å ±å‘Š

### åŠŸèƒ½ âœ…
- [x] 11 å€‹å¾®æœå‹™ç›£æ§é…ç½®
- [x] åŸºç¤è¨­æ–½ç›£æ§ï¼ˆPostgreSQL, Redis, Kafkaï¼‰
- [x] ç³»çµ±å’Œå®¹å™¨ç›£æ§
- [x] 30+ æ¢å‘Šè­¦è¦å‰‡
- [x] æ™ºèƒ½å‘Šè­¦è·¯ç”±
- [x] å¤šæ¸ é“é€šçŸ¥ï¼ˆSlack + Emailï¼‰
- [x] äº’å‹•å¼ç®¡ç†è…³æœ¬
- [x] è‡ªå‹•é©—è­‰è…³æœ¬

### æ¸¬è©¦ï¼ˆå¾…åŸ·è¡Œï¼‰ ğŸ”„
- [ ] å•Ÿå‹•ç›£æ§ç³»çµ±
- [ ] é©—è­‰æ‰€æœ‰å®¹å™¨é‹è¡Œ
- [ ] æª¢æŸ¥ Prometheus Targets
- [ ] é©—è­‰å‘Šè­¦è¦å‰‡è¼‰å…¥
- [ ] æ¸¬è©¦ Grafana è¨ªå•
- [ ] æ¸¬è©¦å‘Šè­¦é€šçŸ¥
- [ ] åŸ·è¡Œå®Œæ•´é©—è­‰è…³æœ¬

---

## ğŸ“ˆ é æœŸæ•ˆç›Š

### æŠ€è¡“æ•ˆç›Š
- âœ… **å…¨é¢å¯è¦–åŒ–**ï¼šæ‰€æœ‰æœå‹™å’Œè³‡æºä¸€ç›®äº†ç„¶
- âœ… **å¿«é€Ÿå®šä½**ï¼šå•é¡Œç™¼ç”Ÿæ™‚å¿«é€Ÿæ‰¾åˆ°æ ¹å› 
- âœ… **é é˜²æ€§ç¶­è­·**ï¼šæå‰ç™¼ç¾æ½›åœ¨å•é¡Œ
- âœ… **æ•ˆèƒ½å„ªåŒ–**ï¼šåŸºæ–¼æ•¸æ“šçš„å„ªåŒ–æ±ºç­–

### æ¥­å‹™æ•ˆç›Š
- âœ… **æé«˜å¯ç”¨æ€§**ï¼šæ¸›å°‘å®•æ©Ÿæ™‚é–“
- âœ… **æ”¹å–„ç”¨æˆ¶é«”é©—**ï¼šæ›´å¿«çš„éŸ¿æ‡‰æ™‚é–“
- âœ… **é™ä½é¢¨éšª**ï¼šé—œéµæ¥­å‹™æŒ‡æ¨™ç›£æ§ï¼ˆæ”¯ä»˜æˆåŠŸç‡ï¼‰
- âœ… **æ•¸æ“šé©…å‹•**ï¼šåŸºæ–¼æŒ‡æ¨™çš„æ¥­å‹™æ±ºç­–

### åœ˜éšŠæ•ˆç›Š
- âœ… **æ¸›å°‘å·¥ä½œé‡**ï¼šè‡ªå‹•åŒ–ç›£æ§å’Œå‘Šè­¦
- âœ… **æé«˜æ•ˆç‡**ï¼šå¿«é€Ÿå®šä½å’Œè§£æ±ºå•é¡Œ
- âœ… **æ”¹å–„å”ä½œ**ï¼šçµ±ä¸€çš„ç›£æ§å¹³å°
- âœ… **çŸ¥è­˜ç´¯ç©**ï¼šå®Œæ•´çš„æ–‡æª”å’Œæœ€ä½³å¯¦è¸

---

## ğŸ“ æ”¯æŒèˆ‡è¯ç¹«

### æ–‡æª”è³‡æº
- **å¿«é€Ÿé–‹å§‹**: `infrastructure/monitoring/README.md`
- **å®Œæ•´æ–‡æª”**: `docs/MONITORING.md`
- **é©—è­‰å ±å‘Š**: `infrastructure/monitoring/DEPLOYMENT-VERIFICATION-REPORT.md`

### åœ˜éšŠè¯ç¹«
- **Slack**: #devops-monitoring
- **Email**: devops@suggar-daddy.com

### ç·Šæ€¥æ”¯æŒ
- **Critical å‘Šè­¦**: ç«‹å³éŸ¿æ‡‰
- **Warning å‘Šè­¦**: 1 å°æ™‚å…§éŸ¿æ‡‰
- **Info å‘Šè­¦**: 24 å°æ™‚å…§éŸ¿æ‡‰

---

## ğŸŠ ç¸½çµ

### å®Œæˆç‹€æ…‹
ğŸ‰ **Prometheus + Grafana ç›£æ§ç³»çµ±å·²å®Œå…¨éƒ¨ç½²ä¸¦æº–å‚™å°±ç·’ï¼**

### ç³»çµ±äº®é»
- âœ… **ä¼æ¥­ç´šç›£æ§è§£æ±ºæ–¹æ¡ˆ**
- âœ… **å®Œæ•´è¦†è“‹ 11 å€‹å¾®æœå‹™**
- âœ… **30+ æ¢æ™ºèƒ½å‘Šè­¦è¦å‰‡**
- âœ… **å¤šæ¸ é“å‘Šè­¦é€šçŸ¥**
- âœ… **è‡ªå‹•åŒ–ç®¡ç†å·¥å…·**
- âœ… **å®Œå–„çš„æ–‡æª”é«”ç³»**

### æŠ€è¡“ç‰¹è‰²
- ğŸš€ 30 ç§’å¿«é€Ÿå•Ÿå‹•
- ğŸ“Š å…¨é¢çš„ç›£æ§è¦†è“‹
- ğŸ”” æ™ºèƒ½å‘Šè­¦ç³»çµ±
- ğŸ¨ å‹å¥½çš„ç”¨æˆ¶ç•Œé¢
- ğŸ”§ æ˜“æ–¼ç¶­è­·å’Œæ“´å±•
- ğŸ“š å®Œæ•´çš„æ–‡æª”æ”¯æŒ

### éƒ¨ç½²ç‹€æ…‹
```
âœ… é…ç½®æ–‡ä»¶: 100% å®Œæˆ
âœ… å‘Šè­¦è¦å‰‡: 100% å®Œæˆ
âœ… è‡ªå‹•åŒ–å·¥å…·: 100% å®Œæˆ
âœ… æ–‡æª”: 100% å®Œæˆ
ğŸ”„ æ¸¬è©¦é©—è­‰: å¾…åœ˜éšŠåŸ·è¡Œ
```

---

## ğŸ“ ä¸‹ä¸€æ­¥è¡Œå‹•

1. **ç«‹å³åŸ·è¡Œ**
   ```bash
   cd infrastructure/monitoring
   ./start-monitoring.sh  # é¸æ“‡ 1: å•Ÿå‹•ç›£æ§ç³»çµ±
   ```

2. **è¨ªå•ç•Œé¢**
   - Grafana: http://localhost:3001 (admin/admin123)
   - Prometheus: http://localhost:9090
   - Alertmanager: http://localhost:9093

3. **é…ç½®å‘Šè­¦**
   - åœ¨ `.env` è¨­ç½® Slack Webhook
   - è¨­ç½® Email SMTP
   - æ¸¬è©¦å‘Šè­¦é€šçŸ¥

4. **åœ˜éšŠåŸ¹è¨“**
   - é–±è®€å®Œæ•´æ–‡æª”
   - å¯¦éš›æ“ä½œç·´ç¿’
   - å»ºç«‹è™•ç†æµç¨‹

---

**ğŸ‰ æ­å–œï¼ç›£æ§ç³»çµ±å·²å°±ç·’ï¼Œç¾åœ¨å¯ä»¥å…¨é¢å®ˆè­·ä½ çš„æ‡‰ç”¨äº†ï¼**

---

*å ±å‘Šå®Œæˆæ—¥æœŸ: 2024-02-14*  
*è² è²¬äºº: DevOps Engineer*  
*ç‰ˆæœ¬: 1.0.0*
