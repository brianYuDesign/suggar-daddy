# Alertmanager 配置文件
# Suggar Daddy 監控系統
# Version: 1.0.0 (開發環境簡化版)

# 全局配置
global:
  # 解析超時
  resolve_timeout: 5m

# 告警路由配置
route:
  # 默認接收者
  receiver: 'default'
  
  # 分組標籤（相同標籤的告警會被分組）
  group_by: ['alertname', 'service', 'severity']
  
  # 分組等待時間（收到第一個告警後等待時間，收集更多告警一起發送）
  group_wait: 10s
  
  # 分組間隔（相同分組的告警多久發送一次）
  group_interval: 5m
  
  # 重複告警間隔（已發送的告警多久後再次發送）
  repeat_interval: 4h

  # 子路由（根據不同條件路由到不同接收者）
  routes:
    # Critical 告警（P0）
    - match:
        severity: critical
      receiver: 'critical-alerts'
      group_wait: 5s
      group_interval: 2m
      repeat_interval: 30m

    # Warning 告警（P1）
    - match:
        severity: warning
      receiver: 'warning-alerts'
      group_wait: 30s
      group_interval: 10m
      repeat_interval: 2h

    # Info 告警（P2）
    - match:
        severity: info
      receiver: 'info-alerts'
      group_wait: 5m
      group_interval: 30m
      repeat_interval: 12h

# 抑制規則（當某些告警觸發時，抑制其他相關告警）
inhibit_rules:
  # 服務不可用時，抑制該服務的其他告警
  - source_match:
      severity: 'critical'
      alertname: 'ServiceDown'
    target_match:
      severity: 'warning'
    equal: ['service']

  # Critical 告警觸發時，抑制同服務的 Warning 告警
  - source_match:
      severity: 'critical'
    target_match:
      severity: 'warning'
    equal: ['service']

# 接收者配置（開發環境版本 - 僅記錄到日誌）
receivers:
  - name: 'default'
  
  - name: 'critical-alerts'
  
  - name: 'warning-alerts'
  
  - name: 'info-alerts'

# 註：生產環境請配置實際的通知渠道
# 配置範例請參考 docs/MONITORING.md
