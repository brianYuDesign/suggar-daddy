# PgBouncer Configuration for PostgreSQL High Availability
# ==========================================================

[databases]
# Database aliases with read/write splitting
# Master (write) connections
suggar_daddy = host=postgres-master port=5432 dbname=suggar_daddy pool_size=25 max_db_connections=50

# Replica (read) connections
suggar_daddy_read = host=postgres-replica port=5432 dbname=suggar_daddy pool_size=50 max_db_connections=100

# Wildcard fallback (optional)
* = host=postgres-master port=5432

[pgbouncer]
# Network Settings
listen_addr = *
listen_port = 6432

# Authentication
auth_type = md5
auth_file = /etc/pgbouncer/userlist.txt

# Administrator
admin_users = postgres
stats_users = postgres

# Connection Pooling
# Pool mode: session, transaction, or statement
pool_mode = transaction

# Max client connections
max_client_conn = 500

# Default pool size
default_pool_size = 25

# Reserve pool
reserve_pool_size = 5

# Reserve pool timeout
reserve_pool_timeout = 3

# Connection timeouts
server_connect_timeout = 15
server_idle_timeout = 600
server_lifetime = 3600
server_login_retry = 15

# Query timeouts
query_timeout = 30
query_wait_timeout = 120

# Client timeouts
client_idle_timeout = 300
client_login_timeout = 60

# DNS
dns_max_ttl = 15
dns_nxdomain_ttl = 15
dns_zone_check_period = 0

# TLS settings (disabled for local development)
;client_tls_sslmode = disable
;server_tls_sslmode = disable

# Logging
log_connections = 1
log_disconnections = 1
log_pooler_errors = 1
log_stats = 1
stats_period = 60

# Verbose logging (disable in production)
verbose = 0

# Console access
unix_socket_dir = /var/run/postgresql
unix_socket_mode = 0777

# Pager
;pager = less

# Health check query
server_check_query = SELECT 1
server_check_delay = 30
server_fast_close = 0

# Application name
application_name_add_host = 1

# Dangerous timeouts (be careful!)
# server_reset_query = DISCARD ALL
# server_reset_query_always = 0

# Ignore startup parameters
ignore_startup_parameters = extra_float_digits,search_path

# Disable JIT (if using PostgreSQL 11+)
# disable_pqexec = 0

# Autodb
autodb_idle_timeout = 3600

# Max prepared statements
max_prepared_statements = 100
