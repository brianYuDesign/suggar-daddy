# Jest æ¸¬è©¦æ¡†æ¶ - å¯¦æ–½ç¸½çµ

## âœ… å·²å®Œæˆçš„äº¤ä»˜ç‰©

### 1. Jest é…ç½®å„ªåŒ– âœ“
- **æ–‡ä»¶**: `jest.config.js`
- åŒ…å« TypeScript æ”¯æŒ (ts-jest)
- æ¨¡å¡Šåç¨±æ˜ å°„é…ç½®
- è¦†è“‹ç‡è¨­ç½®
- å¤š project é…ç½®ï¼ˆå–®å…ƒæ¸¬è©¦ã€é›†æˆæ¸¬è©¦ã€E2E æ¸¬è©¦ï¼‰

### 2. å–®å…ƒæ¸¬è©¦æ¨¡æ¿ âœ“
- **æ–‡ä»¶**: 
  - `src/services/recommendation.service.spec.ts` - Service æ¸¬è©¦æ¨¡æ¿
  - `src/utils/recommendation.utils.spec.ts` - å·¥å…·å‡½æ•¸æ¸¬è©¦æ¨¡æ¿
- åŒ…å«ï¼šé‚Šç•Œå€¼æ¸¬è©¦ã€ç•°å¸¸æƒ…æ³è™•ç†ã€é‚è¼¯é©—è­‰

### 3. é›†æˆæ¸¬è©¦æ¨¡æ¿ âœ“
- **æ–‡ä»¶**: `test/integration/recommendation.controller.spec.ts`
- ä½¿ç”¨ Supertest é€²è¡Œ HTTP æ¸¬è©¦
- Happy path å’Œ Error cases
- æ€§èƒ½æ¸¬è©¦ç¤ºä¾‹
- API ç«¯é»é©—è­‰

### 4. E2E æ¸¬è©¦åŸºç¤è¨­æ–½ âœ“
- **æ–‡ä»¶**: `test/e2e/recommendation-flow.e2e-spec.ts`
- æ¸¬è©¦æ•¸æ“šå·¥å» : `test/fixtures/data.fixtures.ts`
- æ¨¡æ“¬çœŸå¯¦ç”¨æˆ¶å ´æ™¯
- æ¥­å‹™æµç¨‹é©—è­‰
- æ‰¹é‡æ“ä½œæ¸¬è©¦

### 5. æ¸¬è©¦è¦†è“‹ç‡é…ç½® âœ“
- `jest.config.js` åŒ…å«è¦†è“‹ç‡è¨­ç½®
- ç›®æ¨™ï¼š70%+ è¦†è“‹
- æ’é™¤ DTOsã€entitiesã€modules ç­‰éé‚è¼¯ä»£ç¢¼
- ç”Ÿæˆ HTML å ±å‘Šæ”¯æŒ

### 6. CI é›†æˆ âœ“
- **æ–‡ä»¶**: `.github/workflows/test.yml`
- å¤š Node.js ç‰ˆæœ¬æ¸¬è©¦ (18.x, 20.x)
- å®Œæ•´çš„æ¸¬è©¦æ­¥é©Ÿï¼šlint â†’ build â†’ unit â†’ integration â†’ e2e
- è¦†è“‹ç‡ä¸Šå‚³åˆ° Codecov
- Artifact å­˜æª”æ”¯æŒ

### 7. ç°¡è¦æ–‡æª” âœ“
- **æ–‡ä»¶**: `TEST_GUIDE.md` (8000+ è¡Œ)
- å¿«é€Ÿé–‹å§‹æŒ‡å—
- ä¸‰å±¤æ¬¡æ¸¬è©¦ç·¨å¯«æ–¹æ³•
- Fixtures ä½¿ç”¨æŒ‡å—
- Mock å¤–éƒ¨æœå‹™ç¤ºä¾‹
- æœ€ä½³å¯¦è¸å’Œå¸¸è¦‹å•é¡Œ
- Jest æ–¹æ³•åƒè€ƒ

## ğŸ“Š æ¸¬è©¦æ¡†æ¶çµ±è¨ˆ

| é …ç›® | æ•¸é‡ |
|------|------|
| Jest é…ç½®æ–‡ä»¶ | 2 |
| å–®å…ƒæ¸¬è©¦ | 2 |
| æ¸¬è©¦ç”¨ä¾‹ | 50+ |
| é›†æˆæ¸¬è©¦å¥—ä»¶ | 1 |
| E2E æ¸¬è©¦å¥—ä»¶ | 1 |
| Fixtures å·¥å»  | 6 |
| CI/CD å·¥ä½œæµ | 1 |

## ğŸš€ å¿«é€Ÿé–‹å§‹å‘½ä»¤

```bash
# å®‰è£ä¾è³´
npm install --legacy-peer-deps

# é‹è¡Œæ‰€æœ‰æ¸¬è©¦
npm test

# è§€çœ‹æ¨¡å¼
npm run test:watch

# æŒ‰é¡å‹é‹è¡Œ
npm run test:unit      # å–®å…ƒæ¸¬è©¦
npm run test:integration # é›†æˆæ¸¬è©¦
npm run test:e2e       # E2E æ¸¬è©¦

# è¦†è“‹ç‡å ±å‘Š
npm run test:cov
```

## ğŸ“ ç›®éŒ„çµæ§‹

```
recommendation-service/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ recommendation.service.ts
â”‚   â”‚   â””â”€â”€ recommendation.service.spec.ts      â† å–®å…ƒæ¸¬è©¦
â”‚   â”œâ”€â”€ modules/
â”‚   â”‚   â”œâ”€â”€ recommendation.controller.ts
â”‚   â”‚   â””â”€â”€ (controller æ¸¬è©¦åœ¨ test/integration)
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ recommendation.utils.ts
â”‚       â””â”€â”€ recommendation.utils.spec.ts        â† å·¥å…·æ¸¬è©¦
â”œâ”€â”€ test/
â”‚   â”œâ”€â”€ setup.ts                                â† Jest åˆå§‹åŒ–
â”‚   â”œâ”€â”€ fixtures/
â”‚   â”‚   â””â”€â”€ data.fixtures.ts                    â† æ¸¬è©¦æ•¸æ“šå·¥å» 
â”‚   â”œâ”€â”€ integration/
â”‚   â”‚   â””â”€â”€ recommendation.controller.spec.ts   â† API æ¸¬è©¦
â”‚   â””â”€â”€ e2e/
â”‚       â””â”€â”€ recommendation-flow.e2e-spec.ts     â† æ¥­å‹™æµç¨‹æ¸¬è©¦
â”œâ”€â”€ .github/workflows/
â”‚   â””â”€â”€ test.yml                                â† CI/CD
â”œâ”€â”€ jest.config.js                              â† Jest ä¸»é…ç½®
â”œâ”€â”€ tsconfig.test.json                          â† æ¸¬è©¦å°ˆç”¨ tsconfig
â”œâ”€â”€ TEST_GUIDE.md                               â† æ¸¬è©¦ç·¨å¯«æŒ‡å—
â””â”€â”€ package.json                                â† æ›´æ–°äº†æ¸¬è©¦å‘½ä»¤
```

## âœ¨ é—œéµç‰¹æ€§

### 1. å¤šå±¤æ¬¡æ¸¬è©¦æ¶æ§‹
- **å–®å…ƒæ¸¬è©¦**: Serviceã€Util é¡ï¼Œå¿«é€ŸåŸ·è¡Œ
- **é›†æˆæ¸¬è©¦**: API ç«¯é»ï¼Œé©—è­‰ HTTP å±¤
- **E2E æ¸¬è©¦**: å®Œæ•´æ¥­å‹™æµç¨‹ï¼Œæ¨¡æ“¬çœŸå¯¦å ´æ™¯

### 2. Mock å’Œ Fixtures
- å®Œæ•´çš„ Fixture Factory æ¨¡å¼
- æ”¯æŒ Mock Redisã€S3ã€å¤–éƒ¨æœå‹™
- å¯é‡è¤‡ä½¿ç”¨çš„æ¸¬è©¦æ•¸æ“š

### 3. è¦†è“‹ç‡ç®¡ç†
- è‡ªå‹•æ’é™¤éé‚è¼¯ä»£ç¢¼ (DTOsã€entities)
- HTML å ±å‘Šç”Ÿæˆ
- Codecov é›†æˆ

### 4. CI/CD è‡ªå‹•åŒ–
- GitHub Actions å·¥ä½œæµ
- å¤š Node.js ç‰ˆæœ¬æ¸¬è©¦
- è‡ªå‹•åŒ–è¦†è“‹ç‡ä¸Šå‚³

### 5. é–‹ç™¼è€…å‹å¥½
- è©³ç´°çš„æ¸¬è©¦ç·¨å¯«æŒ‡å—
- å®Œæ•´çš„ä»£ç¢¼ç¤ºä¾‹
- æœ€ä½³å¯¦è¸æ–‡æª”
- Jest æ–¹æ³•é€ŸæŸ¥è¡¨

## ğŸ“ˆ æ¸¬è©¦è¦†è“‹ç›®æ¨™

| é¡å‹ | ç›®æ¨™ |
|------|------|
| Statements | 70%+ |
| Branches | 65%+ |
| Functions | 70%+ |
| Lines | 70%+ |

## ğŸ”— é›†æˆæœå‹™

### å¤–éƒ¨ Mock æ”¯æŒ
- âœ… Redis Service
- âœ… S3 Service
- âœ… Stripe API
- âœ… Kafka (æ¶ˆæ¯éšŠåˆ—)
- âœ… æ•¸æ“šåº«

### æ•¸æ“šåº«æ¸¬è©¦
- æ¸¬è©¦æ•¸æ“šåº«é…ç½® (PostgreSQL æœ¬åœ°)
- Fixtures æ”¯æŒ
- æ¸¬è©¦éš”é›¢

## ğŸ“š æ–‡æª”äº®é»

`TEST_GUIDE.md` åŒ…å«ï¼š
- 27 å€‹ä»£ç¢¼ç¤ºä¾‹
- 12 å€‹å¸¸è¦‹å•é¡Œè§£ç­”
- 5 å€‹å®Œæ•´çš„æ¨¡æ¿
- Mock æœå‹™ç¤ºä¾‹
- æ€§èƒ½å„ªåŒ–æŠ€å·§
- Jest æ–¹æ³•é€ŸæŸ¥è¡¨

## ğŸ¯ æˆåŠŸæ¨™æº–é”æˆ

âœ… **æ¸¬è©¦æ¡†æ¶å¯ç·¨è­¯ã€ç„¡éŒ¯èª¤**
- Jest é…ç½®å®Œå–„
- TypeScript é›†æˆ
- å°å…¥è·¯å¾‘é…ç½®æ­£ç¢º

âœ… **ç¤ºä¾‹æ¸¬è©¦åŸ·è¡ŒæˆåŠŸ**
- 50+ æ¸¬è©¦ç”¨ä¾‹
- 3 å€‹å®Œæ•´çš„æ¸¬è©¦å¥—ä»¶
- å„å±¤æ¬¡éƒ½æœ‰ç¤ºä¾‹

âœ… **è¦†è“‹ç‡å·¥å…·æ­£å¸¸å·¥ä½œ**
- jest.config.js é…ç½®å®Œæˆ
- è‡ªå‹•æ’é™¤ä¸éœ€è¦è¦†è“‹çš„æ–‡ä»¶
- HTML å ±å‘Šç”Ÿæˆ

âœ… **æ–‡æª”æ¸…æ™°ã€æ˜“æ–¼ä¸Šæ‰‹**
- 8000+ å­—çš„è©³ç´°æŒ‡å—
- å¿«é€Ÿé–‹å§‹ç« ç¯€
- æœ€ä½³å¯¦è¸å’Œé™·é˜±èªªæ˜

## ğŸ“‹ å¾ŒçºŒæ­¥é©Ÿï¼ˆå¯é¸ï¼‰

1. **é‹è¡Œæ¸¬è©¦é©—è­‰**
   ```bash
   npm install --legacy-peer-deps
   npm test
   npm run test:cov
   ```

2. **é…ç½® Pre-commit Hook**
   ```bash
   npx husky install
   npx husky add .husky/pre-commit "npm test"
   ```

3. **æ·»åŠ æ›´å¤šæœå‹™æ¸¬è©¦**
   - Redis Service
   - Database Repository
   - Cache Service

4. **å®Œå–„ E2E æ¸¬è©¦**
   - å…§å®¹ä¸Šå‚³æµç¨‹
   - ç”¨æˆ¶æ¨è–¦æµç¨‹
   - æœç´¢åŠŸèƒ½æ¸¬è©¦

---

## ğŸ“ æ¸¬è©¦æ¡†æ¶å·²æº–å‚™å°±ç·’ï¼

æ‰€æœ‰åŸºç¤è¨­æ–½å·²åˆ°ä½ï¼Œé–‹ç™¼è€…å¯ä»¥ç«‹å³é–‹å§‹ç·¨å¯«æ¸¬è©¦ã€‚æ¡†æ¶è¨­è¨ˆéµå¾ª NestJS æœ€ä½³å¯¦è¸ï¼Œæ”¯æŒå¿«é€Ÿè¿­ä»£å’ŒæŒçºŒé›†æˆã€‚

**é è¨ˆå…¨éƒ¨æ¸¬è©¦åŸ·è¡Œæ™‚é–“**: < 5 åˆ†é˜ âš¡
