openapi: 3.0.0
info:
  title: Sugar-Daddy Platform - Comprehensive API
  description: |
    å®Œæ•´çš„ Sugar-Daddy å¹³å° API æ–‡æª”
    åŒ…å«æ‰€æœ‰ 81 å€‹ç«¯é»çš„è©³ç´°èªªæ˜
    
    ### ç³»çµ±çµ„æˆ
    - ğŸ” Auth Service (11 å€‹ç«¯é»)
    - ğŸ¬ Content-Streaming Service (11 å€‹ç«¯é»)  
    - ğŸ’³ Payment Service (19 å€‹ç«¯é»)
    - ğŸ Subscription Service (10 å€‹ç«¯é»)
    - ğŸ¤– Recommendation Service (13 å€‹ç«¯é»)
    - ğŸŒ‰ API Gateway (1 å€‹ç«¯é»)
    
    **ç¸½è¨ˆ: 81 å€‹ API ç«¯é»**
  version: 1.0.0
  contact:
    name: Sugar-Daddy Backend Team
    email: backend@sugardaddy.com
  license:
    name: Proprietary
    url: https://sugardaddy.com/license

servers:
  - url: http://localhost:3000
    description: API Gateway (æœ¬åœ°é–‹ç™¼)
    variables:
      port:
        default: '3000'
  - url: https://api.sugardaddy.com/v1
    description: ç”Ÿç”¢ç’°å¢ƒ
  - url: https://staging-api.sugardaddy.com/v1
    description: é ç™¼ä½ˆç’°å¢ƒ

tags:
  - name: Auth
    description: èº«ä»½é©—è­‰èˆ‡æˆæ¬Š
  - name: Content-Streaming
    description: è¦–é »å…§å®¹ç®¡ç†èˆ‡æµåª’é«”
  - name: Payment
    description: æ”¯ä»˜èˆ‡äº¤æ˜“
  - name: Subscription
    description: è¨‚é–±ç®¡ç†
  - name: Recommendation
    description: æ¨è–¦å¼•æ“
  - name: Gateway
    description: ç¶²é—œå¥åº·æª¢æŸ¥

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        JWT access token èªè­‰
        ç™»éŒ„å¾Œç²å¾— tokenï¼Œåœ¨ Authorization header ä¸­ä½¿ç”¨
        æ ¼å¼: Authorization: Bearer <token>

  schemas:
    # ==================== é€šç”¨éŸ¿æ‡‰çµæ§‹ ====================
    ApiResponse:
      type: object
      properties:
        statusCode:
          type: integer
          example: 200
        message:
          type: string
          example: Success
        data:
          type: object
        errors:
          type: array
          items:
            type: object
      required:
        - statusCode
        - message

    ErrorResponse:
      type: object
      properties:
        statusCode:
          type: integer
          example: 400
        message:
          type: string
          example: Bad Request
        errors:
          type: array
          items:
            type: object
            properties:
              field:
                type: string
              message:
                type: string
      required:
        - statusCode
        - message

    # ==================== Auth Service Schemas ====================
    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: 550e8400-e29b-41d4-a716-446655440000
        username:
          type: string
          example: john_doe
        email:
          type: string
          format: email
          example: john@example.com
        firstName:
          type: string
          example: John
        lastName:
          type: string
          example: Doe
        status:
          type: string
          enum: [active, inactive, suspended]
          example: active
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    Role:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
          example: admin
        description:
          type: string
        permissions:
          type: array
          items:
            type: string

    Permission:
      type: object
      properties:
        id:
          type: string
          format: uuid
        resource:
          type: string
          example: users
        action:
          type: string
          example: create
        description:
          type: string

    AuthTokens:
      type: object
      properties:
        accessToken:
          type: string
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        refreshToken:
          type: string
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        expiresIn:
          type: integer
          example: 3600

    # ==================== Content-Streaming Schemas ====================
    Video:
      type: object
      properties:
        id:
          type: string
          format: uuid
        title:
          type: string
          example: My Video
        description:
          type: string
        duration:
          type: integer
          example: 3600
        status:
          type: string
          enum: [draft, processing, ready, archived]
        uploadedBy:
          type: string
          format: uuid
        createdAt:
          type: string
          format: date-time

    UploadSession:
      type: object
      properties:
        sessionId:
          type: string
          format: uuid
        filename:
          type: string
        contentType:
          type: string
        fileSize:
          type: integer
        uploadedBytes:
          type: integer
        expiresAt:
          type: string
          format: date-time

    TranscodingJob:
      type: object
      properties:
        jobId:
          type: string
          format: uuid
        videoId:
          type: string
          format: uuid
        status:
          type: string
          enum: [pending, processing, completed, failed]
        progress:
          type: integer
          minimum: 0
          maximum: 100
        createdAt:
          type: string
          format: date-time

    # ==================== Payment Schemas ====================
    Payment:
      type: object
      properties:
        id:
          type: string
          format: uuid
        userId:
          type: string
          format: uuid
        amount:
          type: number
          format: double
          example: 99.99
        currency:
          type: string
          example: USD
        status:
          type: string
          enum: [pending, completed, failed, refunded]
        paymentMethod:
          type: string
          enum: [credit_card, paypal, stripe, alipay, wechat]
        description:
          type: string
        createdAt:
          type: string
          format: date-time

    PaymentIntent:
      type: object
      properties:
        clientSecret:
          type: string
        amount:
          type: number
        currency:
          type: string
        metadata:
          type: object

    Refund:
      type: object
      properties:
        id:
          type: string
          format: uuid
        paymentId:
          type: string
          format: uuid
        amount:
          type: number
        status:
          type: string
          enum: [pending, completed, failed]
        reason:
          type: string

    # ==================== Subscription Schemas ====================
    Subscription:
      type: object
      properties:
        id:
          type: string
          format: uuid
        userId:
          type: string
          format: uuid
        planId:
          type: string
          format: uuid
        status:
          type: string
          enum: [active, paused, cancelled, expired]
        startDate:
          type: string
          format: date-time
        endDate:
          type: string
          format: date-time
        autoRenew:
          type: boolean
        createdAt:
          type: string
          format: date-time

    SubscriptionPlan:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
          example: Premium Plan
        description:
          type: string
        price:
          type: number
          example: 9.99
        billingCycle:
          type: string
          enum: [monthly, quarterly, yearly]
        features:
          type: array
          items:
            type: string

    BillingHistory:
      type: object
      properties:
        id:
          type: string
          format: uuid
        subscriptionId:
          type: string
          format: uuid
        amount:
          type: number
        billedAt:
          type: string
          format: date-time
        nextBillingDate:
          type: string
          format: date-time
        status:
          type: string
          enum: [pending, successful, failed]

    # ==================== Recommendation Schemas ====================
    Recommendation:
      type: object
      properties:
        id:
          type: string
          format: uuid
        userId:
          type: string
          format: uuid
        contentId:
          type: string
          format: uuid
        score:
          type: number
          format: double
          minimum: 0
          maximum: 1
        reason:
          type: string
          example: Based on your viewing history

    UserInteraction:
      type: object
      properties:
        id:
          type: string
          format: uuid
        userId:
          type: string
          format: uuid
        contentId:
          type: string
          format: uuid
        type:
          type: string
          enum: [view, like, share, comment]
        timestamp:
          type: string
          format: date-time

  responses:
    UnauthorizedError:
      description: æœªæˆæ¬Š
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            statusCode: 401
            message: Unauthorized
            errors:
              - field: token
                message: Invalid or expired token

    NotFoundError:
      description: è³‡æºä¸å­˜åœ¨
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            statusCode: 404
            message: Not Found
            errors:
              - message: Resource not found

    BadRequestError:
      description: è«‹æ±‚æ ¼å¼éŒ¯èª¤
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    InternalServerError:
      description: ä¼ºæœå™¨å…§éƒ¨éŒ¯èª¤
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            statusCode: 500
            message: Internal Server Error

# ============================================================
# PATH å®šç¾©
# ============================================================

paths:
  # ==================== Health Check ====================
  /health:
    get:
      tags:
        - Gateway
      summary: å¥åº·æª¢æŸ¥
      description: æª¢æŸ¥ API ç¶²é—œå’Œæ‰€æœ‰å¾Œç«¯æœå‹™çš„ç‹€æ…‹
      operationId: getHealth
      responses:
        '200':
          description: æ‰€æœ‰æœå‹™æ­£å¸¸é‹è¡Œ
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok
                  timestamp:
                    type: string
                    format: date-time
                  services:
                    type: object
                    properties:
                      auth:
                        type: string
                        example: up
                      contentStreaming:
                        type: string
                        example: up
                      payment:
                        type: string
                        example: up
                      subscription:
                        type: string
                        example: up
                      recommendation:
                        type: string
                        example: up

  # ==================== Auth Service ====================
  /api/auth/register:
    post:
      tags:
        - Auth
      summary: ç”¨æˆ¶è¨»å†Š
      description: è¨»å†Šæ–°ç”¨æˆ¶è³¬æˆ¶
      operationId: register
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                username:
                  type: string
                  example: john_doe
                email:
                  type: string
                  format: email
                  example: john@example.com
                password:
                  type: string
                  format: password
                  example: SecurePassword123!
                firstName:
                  type: string
                lastName:
                  type: string
              required:
                - username
                - email
                - password
      responses:
        '201':
          description: ç”¨æˆ¶è¨»å†ŠæˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  statusCode:
                    type: integer
                    example: 201
                  message:
                    type: string
                    example: User registered successfully
                  data:
                    type: object
                    properties:
                      user:
                        $ref: '#/components/schemas/User'
                      tokens:
                        $ref: '#/components/schemas/AuthTokens'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/auth/login:
    post:
      tags:
        - Auth
      summary: ç”¨æˆ¶ç™»å…¥
      description: ä½¿ç”¨èªè­‰ä¿¡æ¯ç™»å…¥ç³»çµ±
      operationId: login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  format: email
                  example: john@example.com
                password:
                  type: string
                  format: password
                  example: SecurePassword123!
              required:
                - email
                - password
      responses:
        '200':
          description: ç™»å…¥æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  statusCode:
                    type: integer
                    example: 200
                  message:
                    type: string
                    example: Login successful
                  data:
                    type: object
                    properties:
                      user:
                        $ref: '#/components/schemas/User'
                      tokens:
                        $ref: '#/components/schemas/AuthTokens'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '400':
          $ref: '#/components/responses/BadRequestError'

  /api/auth/refresh:
    post:
      tags:
        - Auth
      summary: åˆ·æ–° Token
      description: ä½¿ç”¨ refresh token ç²å¾—æ–°çš„ access token
      operationId: refreshToken
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                refreshToken:
                  type: string
                  example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
              required:
                - refreshToken
      responses:
        '200':
          description: Token åˆ·æ–°æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  statusCode:
                    type: integer
                    example: 200
                  message:
                    type: string
                  data:
                    $ref: '#/components/schemas/AuthTokens'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/auth/logout:
    post:
      tags:
        - Auth
      summary: ç™»å‡º
      description: ç™»å‡ºç”¨æˆ¶æœƒè©±
      operationId: logout
      security:
        - BearerAuth: []
      responses:
        '200':
          description: ç™»å‡ºæˆåŠŸ
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/auth/me:
    get:
      tags:
        - Auth
      summary: ç²å–ç•¶å‰ç”¨æˆ¶ä¿¡æ¯
      description: å–å¾—å·²ç™»å…¥ç”¨æˆ¶çš„å€‹äººä¿¡æ¯
      operationId: getCurrentUser
      security:
        - BearerAuth: []
      responses:
        '200':
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  statusCode:
                    type: integer
                    example: 200
                  message:
                    type: string
                  data:
                    $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/auth/validate:
    post:
      tags:
        - Auth
      summary: é©—è­‰ Token
      description: é©—è­‰ access token çš„æœ‰æ•ˆæ€§
      operationId: validateToken
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                token:
                  type: string
              required:
                - token
      responses:
        '200':
          description: Token æœ‰æ•ˆ
          content:
            application/json:
              schema:
                type: object
                properties:
                  statusCode:
                    type: integer
                    example: 200
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      valid:
                        type: boolean
                      userId:
                        type: string
                      expiresAt:
                        type: string
                        format: date-time
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/auth/change-password:
    post:
      tags:
        - Auth
      summary: æ›´æ”¹å¯†ç¢¼
      description: ä¿®æ”¹ç”¨æˆ¶å¯†ç¢¼
      operationId: changePassword
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                oldPassword:
                  type: string
                  format: password
                newPassword:
                  type: string
                  format: password
              required:
                - oldPassword
                - newPassword
      responses:
        '200':
          description: å¯†ç¢¼æ›´æ”¹æˆåŠŸ
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  # ==================== User Management ====================
  /api/auth/users:
    get:
      tags:
        - Auth
      summary: ç²å–ç”¨æˆ¶åˆ—è¡¨
      description: ç²å–æ‰€æœ‰ç”¨æˆ¶åˆ—è¡¨ï¼ˆéœ€è¦ç®¡ç†å“¡æ¬Šé™ï¼‰
      operationId: listUsers
      security:
        - BearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
        - name: status
          in: query
          schema:
            type: string
            enum: [active, inactive, suspended]
      responses:
        '200':
          description: ç”¨æˆ¶åˆ—è¡¨
          content:
            application/json:
              schema:
                type: object
                properties:
                  statusCode:
                    type: integer
                  data:
                    type: object
                    properties:
                      users:
                        type: array
                        items:
                          $ref: '#/components/schemas/User'
                      pagination:
                        type: object
                        properties:
                          page:
                            type: integer
                          total:
                            type: integer
                          limit:
                            type: integer
        '401':
          $ref: '#/components/responses/UnauthorizedError'

    post:
      tags:
        - Auth
      summary: å‰µå»ºç”¨æˆ¶
      description: å‰µå»ºæ–°ç”¨æˆ¶ï¼ˆéœ€è¦ç®¡ç†å“¡æ¬Šé™ï¼‰
      operationId: createUser
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                username:
                  type: string
                email:
                  type: string
                  format: email
                firstName:
                  type: string
                lastName:
                  type: string
                roles:
                  type: array
                  items:
                    type: string
              required:
                - username
                - email
      responses:
        '201':
          description: ç”¨æˆ¶å‰µå»ºæˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  statusCode:
                    type: integer
                  data:
                    $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/auth/users/{userId}:
    get:
      tags:
        - Auth
      summary: ç²å–ç”¨æˆ¶è©³ç´°ä¿¡æ¯
      description: ç²å–æŒ‡å®šç”¨æˆ¶çš„è©³ç´°ä¿¡æ¯
      operationId: getUserById
      security:
        - BearerAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: ç”¨æˆ¶è©³ç´°ä¿¡æ¯
          content:
            application/json:
              schema:
                type: object
                properties:
                  statusCode:
                    type: integer
                  data:
                    $ref: '#/components/schemas/User'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

    delete:
      tags:
        - Auth
      summary: åˆªé™¤ç”¨æˆ¶
      description: åˆªé™¤æŒ‡å®šç”¨æˆ¶ï¼ˆéœ€è¦ç®¡ç†å“¡æ¬Šé™ï¼‰
      operationId: deleteUser
      security:
        - BearerAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: ç”¨æˆ¶åˆªé™¤æˆåŠŸ
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/auth/users/{userId}/activate:
    post:
      tags:
        - Auth
      summary: æ¿€æ´»ç”¨æˆ¶
      description: æ¿€æ´»å·²ç¦ç”¨çš„ç”¨æˆ¶è³¬æˆ¶
      operationId: activateUser
      security:
        - BearerAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: ç”¨æˆ¶æ¿€æ´»æˆåŠŸ
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/auth/users/{userId}/deactivate:
    post:
      tags:
        - Auth
      summary: ç¦ç”¨ç”¨æˆ¶
      description: ç¦ç”¨ç”¨æˆ¶è³¬æˆ¶
      operationId: deactivateUser
      security:
        - BearerAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: ç”¨æˆ¶ç¦ç”¨æˆåŠŸ
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/auth/profile:
    get:
      tags:
        - Auth
      summary: ç²å–ç”¨æˆ¶è³‡æ–™
      description: ç²å–ç•¶å‰ç™»å…¥ç”¨æˆ¶çš„è©³ç´°è³‡æ–™
      operationId: getUserProfile
      security:
        - BearerAuth: []
      responses:
        '200':
          description: ç”¨æˆ¶è³‡æ–™
          content:
            application/json:
              schema:
                type: object
                properties:
                  statusCode:
                    type: integer
                  data:
                    $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

    patch:
      tags:
        - Auth
      summary: æ›´æ–°ç”¨æˆ¶è³‡æ–™
      description: æ›´æ–°ç•¶å‰ç™»å…¥ç”¨æˆ¶çš„è³‡æ–™
      operationId: updateUserProfile
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                firstName:
                  type: string
                lastName:
                  type: string
                email:
                  type: string
                  format: email
      responses:
        '200':
          description: è³‡æ–™æ›´æ–°æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  statusCode:
                    type: integer
                  data:
                    $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  # ==================== Role Management ====================
  /api/auth/roles:
    get:
      tags:
        - Auth
      summary: ç²å–è§’è‰²åˆ—è¡¨
      description: ç²å–ç³»çµ±ä¸­æ‰€æœ‰è§’è‰²
      operationId: listRoles
      security:
        - BearerAuth: []
      responses:
        '200':
          description: è§’è‰²åˆ—è¡¨
          content:
            application/json:
              schema:
                type: object
                properties:
                  statusCode:
                    type: integer
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Role'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

    post:
      tags:
        - Auth
      summary: å‰µå»ºè§’è‰²
      description: å‰µå»ºæ–°è§’è‰²ï¼ˆéœ€è¦ç®¡ç†å“¡æ¬Šé™ï¼‰
      operationId: createRole
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  example: moderator
                description:
                  type: string
                permissions:
                  type: array
                  items:
                    type: string
              required:
                - name
      responses:
        '201':
          description: è§’è‰²å‰µå»ºæˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  statusCode:
                    type: integer
                  data:
                    $ref: '#/components/schemas/Role'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/auth/roles/{roleId}:
    get:
      tags:
        - Auth
      summary: ç²å–è§’è‰²è©³ç´°ä¿¡æ¯
      description: ç²å–æŒ‡å®šè§’è‰²çš„è©³ç´°ä¿¡æ¯
      operationId: getRoleById
      security:
        - BearerAuth: []
      parameters:
        - name: roleId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: è§’è‰²è©³ç´°ä¿¡æ¯
          content:
            application/json:
              schema:
                type: object
                properties:
                  statusCode:
                    type: integer
                  data:
                    $ref: '#/components/schemas/Role'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

    patch:
      tags:
        - Auth
      summary: æ›´æ–°è§’è‰²
      description: æ›´æ–°è§’è‰²ä¿¡æ¯ï¼ˆéœ€è¦ç®¡ç†å“¡æ¬Šé™ï¼‰
      operationId: updateRole
      security:
        - BearerAuth: []
      parameters:
        - name: roleId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                description:
                  type: string
      responses:
        '200':
          description: è§’è‰²æ›´æ–°æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  statusCode:
                    type: integer
                  data:
                    $ref: '#/components/schemas/Role'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/auth/roles/{roleId}/permissions:
    get:
      tags:
        - Auth
      summary: ç²å–è§’è‰²æ¬Šé™
      description: ç²å–æŒ‡å®šè§’è‰²çš„æ‰€æœ‰æ¬Šé™
      operationId: getRolePermissions
      security:
        - BearerAuth: []
      parameters:
        - name: roleId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: è§’è‰²æ¬Šé™åˆ—è¡¨
          content:
            application/json:
              schema:
                type: object
                properties:
                  statusCode:
                    type: integer
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Permission'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

    post:
      tags:
        - Auth
      summary: æ·»åŠ è§’è‰²æ¬Šé™
      description: ç‚ºè§’è‰²æ·»åŠ æ¬Šé™ï¼ˆéœ€è¦ç®¡ç†å“¡æ¬Šé™ï¼‰
      operationId: addRolePermission
      security:
        - BearerAuth: []
      parameters:
        - name: roleId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                permissionId:
                  type: string
                  format: uuid
              required:
                - permissionId
      responses:
        '200':
          description: æ¬Šé™æ·»åŠ æˆåŠŸ
        '400':
          $ref: '#/components/responses/BadRequestError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  # ==================== Permission Management ====================
  /api/auth/permissions:
    get:
      tags:
        - Auth
      summary: ç²å–æ¬Šé™åˆ—è¡¨
      description: ç²å–ç³»çµ±ä¸­æ‰€æœ‰å¯ç”¨çš„æ¬Šé™
      operationId: listPermissions
      security:
        - BearerAuth: []
      parameters:
        - name: resource
          in: query
          schema:
            type: string
          description: æŒ‰è³‡æºç¯©é¸
      responses:
        '200':
          description: æ¬Šé™åˆ—è¡¨
          content:
            application/json:
              schema:
                type: object
                properties:
                  statusCode:
                    type: integer
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Permission'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  # ==================== Content-Streaming Service ====================
  /api/uploads/initiate:
    post:
      tags:
        - Content-Streaming
      summary: åˆå§‹åŒ–ä¸Šå‚³æœƒè©±
      description: é–‹å§‹åˆ†ç‰‡ä¸Šå‚³ï¼Œç²å¾—æœƒè©± ID
      operationId: initiateUpload
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                filename:
                  type: string
                  example: my-video.mp4
                contentType:
                  type: string
                  example: video/mp4
                fileSize:
                  type: integer
                  example: 524288000
              required:
                - filename
                - contentType
                - fileSize
      responses:
        '201':
          description: ä¸Šå‚³æœƒè©±å·²å‰µå»º
          content:
            application/json:
              schema:
                type: object
                properties:
                  statusCode:
                    type: integer
                  data:
                    $ref: '#/components/schemas/UploadSession'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/uploads/{sessionId}:
    get:
      tags:
        - Content-Streaming
      summary: ç²å–ä¸Šå‚³ç‹€æ…‹
      description: ç²å–æŒ‡å®šä¸Šå‚³æœƒè©±çš„ç•¶å‰ç‹€æ…‹
      operationId: getUploadStatus
      security:
        - BearerAuth: []
      parameters:
        - name: sessionId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: ä¸Šå‚³ç‹€æ…‹
          content:
            application/json:
              schema:
                type: object
                properties:
                  statusCode:
                    type: integer
                  data:
                    $ref: '#/components/schemas/UploadSession'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/uploads/{sessionId}/chunk:
    post:
      tags:
        - Content-Streaming
      summary: ä¸Šå‚³åˆ†ç‰‡
      description: ä¸Šå‚³è¦–é »æ–‡ä»¶çš„ä¸€éƒ¨åˆ†
      operationId: uploadChunk
      security:
        - BearerAuth: []
      parameters:
        - name: sessionId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: chunkIndex
          in: query
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/octet-stream:
            schema:
              type: string
              format: binary
      responses:
        '200':
          description: åˆ†ç‰‡ä¸Šå‚³æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  statusCode:
                    type: integer
                  data:
                    type: object
                    properties:
                      chunkIndex:
                        type: integer
                      uploadedBytes:
                        type: integer
        '400':
          $ref: '#/components/responses/BadRequestError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/uploads/{sessionId}/complete:
    post:
      tags:
        - Content-Streaming
      summary: å®Œæˆä¸Šå‚³
      description: å®Œæˆä¸Šå‚³æœƒè©±ï¼Œé–‹å§‹è½‰ç¢¼
      operationId: completeUpload
      security:
        - BearerAuth: []
      parameters:
        - name: sessionId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                description:
                  type: string
                tags:
                  type: array
                  items:
                    type: string
              required:
                - title
      responses:
        '200':
          description: ä¸Šå‚³å®Œæˆï¼Œè½‰ç¢¼å·²å•Ÿå‹•
          content:
            application/json:
              schema:
                type: object
                properties:
                  statusCode:
                    type: integer
                  data:
                    type: object
                    properties:
                      videoId:
                        type: string
                        format: uuid
                      message:
                        type: string
        '400':
          $ref: '#/components/responses/BadRequestError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/videos:
    get:
      tags:
        - Content-Streaming
      summary: ç²å–è¦–é »åˆ—è¡¨
      description: ç²å–æ‰€æœ‰å·²ç™¼ä½ˆçš„è¦–é »
      operationId: listVideos
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
        - name: search
          in: query
          schema:
            type: string
        - name: sort
          in: query
          schema:
            type: string
            enum: [newest, oldest, trending]
            default: newest
      responses:
        '200':
          description: è¦–é »åˆ—è¡¨
          content:
            application/json:
              schema:
                type: object
                properties:
                  statusCode:
                    type: integer
                  data:
                    type: object
                    properties:
                      videos:
                        type: array
                        items:
                          $ref: '#/components/schemas/Video'
                      pagination:
                        type: object
                        properties:
                          page:
                            type: integer
                          total:
                            type: integer
                          limit:
                            type: integer

    post:
      tags:
        - Content-Streaming
      summary: å‰µå»ºè¦–é »è¨˜éŒ„
      description: å‰µå»ºæ–°çš„è¦–é »è¨˜éŒ„ï¼ˆé€šå¸¸åœ¨ä¸Šå‚³å®Œæˆå¾Œï¼‰
      operationId: createVideo
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                description:
                  type: string
                uploadSessionId:
                  type: string
                  format: uuid
              required:
                - title
                - uploadSessionId
      responses:
        '201':
          description: è¦–é »è¨˜éŒ„å‰µå»ºæˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  statusCode:
                    type: integer
                  data:
                    $ref: '#/components/schemas/Video'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/videos/{videoId}:
    get:
      tags:
        - Content-Streaming
      summary: ç²å–è¦–é »è©³ç´°ä¿¡æ¯
      description: ç²å–æŒ‡å®šè¦–é »çš„è©³ç´°ä¿¡æ¯
      operationId: getVideoById
      parameters:
        - name: videoId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: è¦–é »è©³ç´°ä¿¡æ¯
          content:
            application/json:
              schema:
                type: object
                properties:
                  statusCode:
                    type: integer
                  data:
                    $ref: '#/components/schemas/Video'
        '404':
          $ref: '#/components/responses/NotFoundError'

    patch:
      tags:
        - Content-Streaming
      summary: æ›´æ–°è¦–é »ä¿¡æ¯
      description: æ›´æ–°è¦–é »çš„å…ƒæ•¸æ“š
      operationId: updateVideo
      security:
        - BearerAuth: []
      parameters:
        - name: videoId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                description:
                  type: string
                tags:
                  type: array
                  items:
                    type: string
      responses:
        '200':
          description: è¦–é »ä¿¡æ¯æ›´æ–°æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  statusCode:
                    type: integer
                  data:
                    $ref: '#/components/schemas/Video'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

    delete:
      tags:
        - Content-Streaming
      summary: åˆªé™¤è¦–é »
      description: åˆªé™¤è¦–é »è¨˜éŒ„å’Œç›¸é—œæ–‡ä»¶
      operationId: deleteVideo
      security:
        - BearerAuth: []
      parameters:
        - name: videoId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: è¦–é »åˆªé™¤æˆåŠŸ
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/videos/{videoId}/stream:
    get:
      tags:
        - Content-Streaming
      summary: æµåª’é«”æ’­æ”¾
      description: æµå¼å‚³è¼¸è¦–é »æ–‡ä»¶
      operationId: streamVideo
      parameters:
        - name: videoId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: quality
          in: query
          schema:
            type: string
            enum: [360p, 480p, 720p, 1080p]
            default: 720p
      responses:
        '206':
          description: è¦–é »æµåª’é«”å…§å®¹ï¼ˆæ”¯æŒç¯„åœè«‹æ±‚ï¼‰
          content:
            video/mp4:
              schema:
                type: string
                format: binary
        '404':
          $ref: '#/components/responses/NotFoundError'

  /api/transcoding:
    get:
      tags:
        - Content-Streaming
      summary: ç²å–è½‰ç¢¼ä»»å‹™åˆ—è¡¨
      description: ç²å–æ‰€æœ‰è½‰ç¢¼ä»»å‹™çš„ç‹€æ…‹
      operationId: listTranscodingJobs
      security:
        - BearerAuth: []
      parameters:
        - name: status
          in: query
          schema:
            type: string
            enum: [pending, processing, completed, failed]
      responses:
        '200':
          description: è½‰ç¢¼ä»»å‹™åˆ—è¡¨
          content:
            application/json:
              schema:
                type: object
                properties:
                  statusCode:
                    type: integer
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/TranscodingJob'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/transcoding/{jobId}:
    get:
      tags:
        - Content-Streaming
      summary: ç²å–è½‰ç¢¼ä»»å‹™ç‹€æ…‹
      description: ç²å–æŒ‡å®šè½‰ç¢¼ä»»å‹™çš„è©³ç´°ç‹€æ…‹
      operationId: getTranscodingJobStatus
      security:
        - BearerAuth: []
      parameters:
        - name: jobId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: è½‰ç¢¼ä»»å‹™ç‹€æ…‹
          content:
            application/json:
              schema:
                type: object
                properties:
                  statusCode:
                    type: integer
                  data:
                    $ref: '#/components/schemas/TranscodingJob'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/quality-configs:
    get:
      tags:
        - Content-Streaming
      summary: ç²å–è³ªé‡é…ç½®
      description: ç²å–è¦–é »è³ªé‡é…ç½®åˆ—è¡¨
      operationId: listQualityConfigs
      responses:
        '200':
          description: è³ªé‡é…ç½®åˆ—è¡¨
          content:
            application/json:
              schema:
                type: object
                properties:
                  statusCode:
                    type: integer
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        quality:
                          type: string
                        resolution:
                          type: string
                        bitrate:
                          type: string
                        codec:
                          type: string

  # ==================== Payment Service ====================
  /api/payments/intent:
    post:
      tags:
        - Payment
      summary: å‰µå»ºæ”¯ä»˜æ„åœ–
      description: åˆå§‹åŒ–æ”¯ä»˜æµç¨‹ï¼Œç²å¾—å®¢æˆ¶ç«¯å¯†é‘°
      operationId: createPaymentIntent
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                amount:
                  type: number
                  example: 99.99
                currency:
                  type: string
                  example: USD
                paymentMethod:
                  type: string
                  enum: [credit_card, paypal, stripe, alipay, wechat]
                description:
                  type: string
                metadata:
                  type: object
              required:
                - amount
                - currency
                - paymentMethod
      responses:
        '201':
          description: æ”¯ä»˜æ„åœ–å·²å‰µå»º
          content:
            application/json:
              schema:
                type: object
                properties:
                  statusCode:
                    type: integer
                  data:
                    $ref: '#/components/schemas/PaymentIntent'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/payments/confirm:
    post:
      tags:
        - Payment
      summary: ç¢ºèªæ”¯ä»˜
      description: ç¢ºèªä¸¦å®Œæˆæ”¯ä»˜äº¤æ˜“
      operationId: confirmPayment
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                paymentIntentId:
                  type: string
                paymentMethodId:
                  type: string
                  description: æ”¯ä»˜æ–¹å¼çš„ token æˆ– ID
              required:
                - paymentIntentId
      responses:
        '200':
          description: æ”¯ä»˜å·²ç¢ºèª
          content:
            application/json:
              schema:
                type: object
                properties:
                  statusCode:
                    type: integer
                  data:
                    $ref: '#/components/schemas/Payment'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/payments:
    get:
      tags:
        - Payment
      summary: ç²å–æ”¯ä»˜åˆ—è¡¨
      description: ç²å–ç•¶å‰ç”¨æˆ¶çš„æ‰€æœ‰æ”¯ä»˜è¨˜éŒ„
      operationId: listPayments
      security:
        - BearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
        - name: status
          in: query
          schema:
            type: string
            enum: [pending, completed, failed, refunded]
        - name: dateFrom
          in: query
          schema:
            type: string
            format: date-time
        - name: dateTo
          in: query
          schema:
            type: string
            format: date-time
      responses:
        '200':
          description: æ”¯ä»˜è¨˜éŒ„åˆ—è¡¨
          content:
            application/json:
              schema:
                type: object
                properties:
                  statusCode:
                    type: integer
                  data:
                    type: object
                    properties:
                      payments:
                        type: array
                        items:
                          $ref: '#/components/schemas/Payment'
                      pagination:
                        type: object
                        properties:
                          page:
                            type: integer
                          total:
                            type: integer
                          limit:
                            type: integer
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/payments/{paymentId}:
    get:
      tags:
        - Payment
      summary: ç²å–æ”¯ä»˜è©³ç´°ä¿¡æ¯
      description: ç²å–æŒ‡å®šæ”¯ä»˜çš„è©³ç´°ä¿¡æ¯
      operationId: getPaymentById
      security:
        - BearerAuth: []
      parameters:
        - name: paymentId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: æ”¯ä»˜è©³ç´°ä¿¡æ¯
          content:
            application/json:
              schema:
                type: object
                properties:
                  statusCode:
                    type: integer
                  data:
                    $ref: '#/components/schemas/Payment'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/payments/user/{userId}:
    get:
      tags:
        - Payment
      summary: ç²å–ç‰¹å®šç”¨æˆ¶çš„æ”¯ä»˜è¨˜éŒ„
      description: ç²å–æŒ‡å®šç”¨æˆ¶çš„æ‰€æœ‰æ”¯ä»˜è¨˜éŒ„ï¼ˆéœ€è¦ç®¡ç†å“¡æ¬Šé™ï¼‰
      operationId: getUserPayments
      security:
        - BearerAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: ç”¨æˆ¶æ”¯ä»˜è¨˜éŒ„
          content:
            application/json:
              schema:
                type: object
                properties:
                  statusCode:
                    type: integer
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Payment'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/payments/refund:
    post:
      tags:
        - Payment
      summary: ç”³è«‹é€€æ¬¾
      description: ç‚ºå·²å®Œæˆçš„æ”¯ä»˜ç”³è«‹é€€æ¬¾
      operationId: requestRefund
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                paymentId:
                  type: string
                  format: uuid
                amount:
                  type: number
                  description: é€€æ¬¾é‡‘é¡ï¼ˆå¦‚ä¸æä¾›å‰‡å…¨é¡é€€æ¬¾ï¼‰
                reason:
                  type: string
                  enum: [user_requested, defective, changed_mind, duplicate, other]
              required:
                - paymentId
                - reason
      responses:
        '200':
          description: é€€æ¬¾ç”³è«‹å·²æäº¤
          content:
            application/json:
              schema:
                type: object
                properties:
                  statusCode:
                    type: integer
                  data:
                    $ref: '#/components/schemas/Refund'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/payments/refunds:
    get:
      tags:
        - Payment
      summary: ç²å–é€€æ¬¾åˆ—è¡¨
      description: ç²å–ç•¶å‰ç”¨æˆ¶çš„æ‰€æœ‰é€€æ¬¾è¨˜éŒ„
      operationId: listRefunds
      security:
        - BearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
        - name: status
          in: query
          schema:
            type: string
            enum: [pending, completed, failed]
      responses:
        '200':
          description: é€€æ¬¾è¨˜éŒ„åˆ—è¡¨
          content:
            application/json:
              schema:
                type: object
                properties:
                  statusCode:
                    type: integer
                  data:
                    type: object
                    properties:
                      refunds:
                        type: array
                        items:
                          $ref: '#/components/schemas/Refund'
                      pagination:
                        type: object
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/payments/refunds/{refundId}:
    get:
      tags:
        - Payment
      summary: ç²å–é€€æ¬¾è©³ç´°ä¿¡æ¯
      description: ç²å–æŒ‡å®šé€€æ¬¾çš„è©³ç´°ä¿¡æ¯
      operationId: getRefundById
      security:
        - BearerAuth: []
      parameters:
        - name: refundId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: é€€æ¬¾è©³ç´°ä¿¡æ¯
          content:
            application/json:
              schema:
                type: object
                properties:
                  statusCode:
                    type: integer
                  data:
                    $ref: '#/components/schemas/Refund'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/payments/webhooks/stripe:
    post:
      tags:
        - Payment
      summary: Stripe Webhook
      description: æ¥æ”¶ Stripe çš„ç•°æ­¥äº‹ä»¶é€šçŸ¥
      operationId: handleStripeWebhook
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: Webhook å·²è™•ç†
        '400':
          description: ç„¡æ•ˆçš„ webhook

  /api/payments/analytics:
    get:
      tags:
        - Payment
      summary: ç²å–æ”¯ä»˜åˆ†ææ•¸æ“š
      description: ç²å–æ”¯ä»˜ç›¸é—œçš„çµ±è¨ˆå’Œåˆ†ææ•¸æ“š
      operationId: getPaymentAnalytics
      security:
        - BearerAuth: []
      parameters:
        - name: dateFrom
          in: query
          required: true
          schema:
            type: string
            format: date-time
        - name: dateTo
          in: query
          required: true
          schema:
            type: string
            format: date-time
      responses:
        '200':
          description: æ”¯ä»˜åˆ†ææ•¸æ“š
          content:
            application/json:
              schema:
                type: object
                properties:
                  statusCode:
                    type: integer
                  data:
                    type: object
                    properties:
                      totalRevenue:
                        type: number
                      totalTransactions:
                        type: integer
                      averageTransactionValue:
                        type: number
                      refundRate:
                        type: number
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  # ==================== Subscription Service ====================
  /api/subscriptions/plans:
    get:
      tags:
        - Subscription
      summary: ç²å–è¨‚é–±è¨ˆåŠƒåˆ—è¡¨
      description: ç²å–æ‰€æœ‰å¯ç”¨çš„è¨‚é–±è¨ˆåŠƒ
      operationId: listSubscriptionPlans
      responses:
        '200':
          description: è¨‚é–±è¨ˆåŠƒåˆ—è¡¨
          content:
            application/json:
              schema:
                type: object
                properties:
                  statusCode:
                    type: integer
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/SubscriptionPlan'

  /api/subscriptions/plans/{planId}:
    get:
      tags:
        - Subscription
      summary: ç²å–è¨‚é–±è¨ˆåŠƒè©³ç´°ä¿¡æ¯
      description: ç²å–æŒ‡å®šè¨‚é–±è¨ˆåŠƒçš„è©³ç´°ä¿¡æ¯
      operationId: getSubscriptionPlanById
      parameters:
        - name: planId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: è¨‚é–±è¨ˆåŠƒè©³ç´°ä¿¡æ¯
          content:
            application/json:
              schema:
                type: object
                properties:
                  statusCode:
                    type: integer
                  data:
                    $ref: '#/components/schemas/SubscriptionPlan'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /api/subscriptions:
    get:
      tags:
        - Subscription
      summary: ç²å–ç•¶å‰ç”¨æˆ¶çš„è¨‚é–±
      description: ç²å–ç•¶å‰ç™»å…¥ç”¨æˆ¶çš„æ‰€æœ‰è¨‚é–±
      operationId: getCurrentUserSubscriptions
      security:
        - BearerAuth: []
      responses:
        '200':
          description: ç”¨æˆ¶è¨‚é–±åˆ—è¡¨
          content:
            application/json:
              schema:
                type: object
                properties:
                  statusCode:
                    type: integer
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Subscription'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

    post:
      tags:
        - Subscription
      summary: å‰µå»ºè¨‚é–±
      description: ç‚ºç•¶å‰ç”¨æˆ¶å‰µå»ºæ–°çš„è¨‚é–±
      operationId: createSubscription
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                planId:
                  type: string
                  format: uuid
                autoRenew:
                  type: boolean
                  default: true
                paymentMethodId:
                  type: string
                  description: æ”¯ä»˜æ–¹å¼ ID
              required:
                - planId
      responses:
        '201':
          description: è¨‚é–±å‰µå»ºæˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  statusCode:
                    type: integer
                  data:
                    $ref: '#/components/schemas/Subscription'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/subscriptions/{subscriptionId}:
    get:
      tags:
        - Subscription
      summary: ç²å–è¨‚é–±è©³ç´°ä¿¡æ¯
      description: ç²å–æŒ‡å®šè¨‚é–±çš„è©³ç´°ä¿¡æ¯
      operationId: getSubscriptionById
      security:
        - BearerAuth: []
      parameters:
        - name: subscriptionId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: è¨‚é–±è©³ç´°ä¿¡æ¯
          content:
            application/json:
              schema:
                type: object
                properties:
                  statusCode:
                    type: integer
                  data:
                    $ref: '#/components/schemas/Subscription'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

    patch:
      tags:
        - Subscription
      summary: æ›´æ–°è¨‚é–±
      description: æ›´æ–°è¨‚é–±çš„é…ç½®ï¼ˆå¦‚è‡ªå‹•çºŒæœŸï¼‰
      operationId: updateSubscription
      security:
        - BearerAuth: []
      parameters:
        - name: subscriptionId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                autoRenew:
                  type: boolean
      responses:
        '200':
          description: è¨‚é–±æ›´æ–°æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  statusCode:
                    type: integer
                  data:
                    $ref: '#/components/schemas/Subscription'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/subscriptions/{subscriptionId}/cancel:
    post:
      tags:
        - Subscription
      summary: å–æ¶ˆè¨‚é–±
      description: ç«‹å³å–æ¶ˆè¨‚é–±
      operationId: cancelSubscription
      security:
        - BearerAuth: []
      parameters:
        - name: subscriptionId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                reason:
                  type: string
                  description: å–æ¶ˆåŸå› ï¼ˆå¯é¸ï¼‰
      responses:
        '200':
          description: è¨‚é–±å·²å–æ¶ˆ
          content:
            application/json:
              schema:
                type: object
                properties:
                  statusCode:
                    type: integer
                  data:
                    $ref: '#/components/schemas/Subscription'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/subscriptions/{subscriptionId}/pause:
    post:
      tags:
        - Subscription
      summary: æš«åœè¨‚é–±
      description: æš«åœè¨‚é–±ï¼Œåœ¨æŒ‡å®šæœŸé–“ä¸è¨ˆè²»
      operationId: pauseSubscription
      security:
        - BearerAuth: []
      parameters:
        - name: subscriptionId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                reason:
                  type: string
                  description: æš«åœåŸå› ï¼ˆå¯é¸ï¼‰
      responses:
        '200':
          description: è¨‚é–±å·²æš«åœ
          content:
            application/json:
              schema:
                type: object
                properties:
                  statusCode:
                    type: integer
                  data:
                    $ref: '#/components/schemas/Subscription'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/subscriptions/{subscriptionId}/resume:
    post:
      tags:
        - Subscription
      summary: æ¢å¾©è¨‚é–±
      description: æ¢å¾©å·²æš«åœçš„è¨‚é–±
      operationId: resumeSubscription
      security:
        - BearerAuth: []
      parameters:
        - name: subscriptionId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: è¨‚é–±å·²æ¢å¾©
          content:
            application/json:
              schema:
                type: object
                properties:
                  statusCode:
                    type: integer
                  data:
                    $ref: '#/components/schemas/Subscription'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/subscriptions/{subscriptionId}/billing-history:
    get:
      tags:
        - Subscription
      summary: ç²å–å¸³å–®æ­·å²
      description: ç²å–è¨‚é–±çš„å¸³å–®æ­·å²è¨˜éŒ„
      operationId: getSubscriptionBillingHistory
      security:
        - BearerAuth: []
      parameters:
        - name: subscriptionId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
      responses:
        '200':
          description: å¸³å–®æ­·å²
          content:
            application/json:
              schema:
                type: object
                properties:
                  statusCode:
                    type: integer
                  data:
                    type: object
                    properties:
                      billingHistory:
                        type: array
                        items:
                          $ref: '#/components/schemas/BillingHistory'
                      pagination:
                        type: object
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/subscriptions/user/{userId}:
    get:
      tags:
        - Subscription
      summary: ç²å–ç‰¹å®šç”¨æˆ¶çš„è¨‚é–±
      description: ç²å–æŒ‡å®šç”¨æˆ¶çš„æ‰€æœ‰è¨‚é–±ï¼ˆéœ€è¦ç®¡ç†å“¡æ¬Šé™ï¼‰
      operationId: getUserSubscriptions
      security:
        - BearerAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: ç”¨æˆ¶è¨‚é–±åˆ—è¡¨
          content:
            application/json:
              schema:
                type: object
                properties:
                  statusCode:
                    type: integer
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Subscription'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  # ==================== Recommendation Service ====================
  /api/recommendations:
    get:
      tags:
        - Recommendation
      summary: ç²å–æ¨è–¦åˆ—è¡¨
      description: ç²å–ç•¶å‰ç”¨æˆ¶çš„å€‹æ€§åŒ–æ¨è–¦å…§å®¹
      operationId: getRecommendations
      security:
        - BearerAuth: []
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
      responses:
        '200':
          description: æ¨è–¦å…§å®¹åˆ—è¡¨
          content:
            application/json:
              schema:
                type: object
                properties:
                  statusCode:
                    type: integer
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Recommendation'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

    post:
      tags:
        - Recommendation
      summary: å‰µå»ºæ¨è–¦é…ç½®
      description: ç‚ºç”¨æˆ¶å‰µå»ºè‡ªå®šç¾©æ¨è–¦é…ç½®
      operationId: createRecommendationConfig
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                preferences:
                  type: array
                  items:
                    type: string
                excludeWatched:
                  type: boolean
                  default: true
      responses:
        '201':
          description: æ¨è–¦é…ç½®å·²å‰µå»º
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/recommendations/{contentId}:
    get:
      tags:
        - Recommendation
      summary: ç²å–ç›¸ä¼¼å…§å®¹æ¨è–¦
      description: ç²å–èˆ‡æŒ‡å®šå…§å®¹ç›¸ä¼¼çš„æ¨è–¦
      operationId: getSimilarContent
      parameters:
        - name: contentId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
      responses:
        '200':
          description: ç›¸ä¼¼å…§å®¹æ¨è–¦
          content:
            application/json:
              schema:
                type: object
                properties:
                  statusCode:
                    type: integer
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Recommendation'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /api/recommendations/{contentId}/like:
    post:
      tags:
        - Recommendation
      summary: æ¨™è¨˜å…§å®¹ç‚ºå–œæ­¡
      description: è¨˜éŒ„ç”¨æˆ¶å°å…§å®¹çš„å–œæ­¡
      operationId: likeContent
      security:
        - BearerAuth: []
      parameters:
        - name: contentId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: å·²è¨˜éŒ„å–œæ­¡
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/recommendations/{contentId}/view:
    post:
      tags:
        - Recommendation
      summary: è¨˜éŒ„è§€çœ‹
      description: è¨˜éŒ„ç”¨æˆ¶å°å…§å®¹çš„è§€çœ‹
      operationId: recordView
      security:
        - BearerAuth: []
      parameters:
        - name: contentId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                watchDuration:
                  type: integer
                  description: è§€çœ‹æ™‚é•·ï¼ˆç§’ï¼‰
              required:
                - watchDuration
      responses:
        '200':
          description: è§€çœ‹å·²è¨˜éŒ„
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/recommendations/interactions:
    post:
      tags:
        - Recommendation
      summary: è¨˜éŒ„ç”¨æˆ¶äº¤äº’
      description: è¨˜éŒ„ç”¨æˆ¶èˆ‡å…§å®¹çš„äº¤äº’ï¼ˆè©•è«–ã€åˆ†äº«ç­‰ï¼‰
      operationId: recordInteraction
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                contentId:
                  type: string
                  format: uuid
                type:
                  type: string
                  enum: [view, like, share, comment]
                metadata:
                  type: object
              required:
                - contentId
                - type
      responses:
        '201':
          description: äº¤äº’å·²è¨˜éŒ„
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/recommendations/refresh/{userId}:
    post:
      tags:
        - Recommendation
      summary: åˆ·æ–°ç”¨æˆ¶æ¨è–¦
      description: å¼·åˆ¶åˆ·æ–°ç”¨æˆ¶çš„æ¨è–¦ç®—æ³•
      operationId: refreshUserRecommendations
      security:
        - BearerAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: æ¨è–¦å·²åˆ·æ–°
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/recommendations/update-scores:
    post:
      tags:
        - Recommendation
      summary: æ›´æ–°æ¨è–¦è©•åˆ†
      description: å¾Œè‡ºä»»å‹™ï¼šæ›´æ–°æ‰€æœ‰ç”¨æˆ¶çš„æ¨è–¦è©•åˆ†
      operationId: updateRecommendationScores
      security:
        - BearerAuth: []
      responses:
        '200':
          description: è©•åˆ†æ›´æ–°å·²å•Ÿå‹•
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/recommendations/clear-cache:
    post:
      tags:
        - Recommendation
      summary: æ¸…é™¤æ¨è–¦å¿«å–
      description: æ¸…é™¤æ¨è–¦å¼•æ“çš„å¿«å–
      operationId: clearRecommendationCache
      security:
        - BearerAuth: []
      responses:
        '200':
          description: å¿«å–å·²æ¸…é™¤
        '401':
          $ref: '#/components/responses/UnauthorizedError'

security:
  - BearerAuth: []
