# 服务合并优化计划

## 背景
当前系统有 17 个应用服务，部分服务可能存在过度拆分。本计划提出服务合并建议，以简化架构。

## 建议合并方案

### 1. content-service + content-streaming-service (可选)

**当前状态**
- content-service: 帖子、故事、发现、审核
- content-streaming-service: 视频上传、转码、流媒体

**合并利弊**
- ✅ 合并后内容管理更统一
- ✅ 减少服务间通信
- ❌ 职责边界可能模糊
- ❌ 视频处理负载可能影响其他功能

**建议**: 暂不合并，保持现状，但需明确分工
- content-service: 内容元数据、发现、审核
- content-streaming-service: 视频处理、转码、流媒体

### 2. skill-service → user-service

**当前状态**
- skill-service: 3013 端口，处理用户技能
- user-service: 3001 端口，处理用户核心数据

**合并利弊**
- ✅ 技能是用户属性的一部分
- ✅ 减少一个服务的运维成本
- ❌ 需要迁移数据
- ❌ 可能影响现有 API 路由

**建议**: 短期保持独立，长期考虑合并

### 3. db-writer-service 评估

**当前状态**
- db-writer-service: 3010 端口，专门处理数据库写入

**评估**
- 这是为了读写分离而设计的
- 如果写入量不大，可以合并到各服务
- 如果写入量大，保持独立有利于性能优化

**建议**: 保持现状，监控写入负载

## 实施优先级

### 短期 (1-3 个月)
1. ✅ 已完成: 端口冲突修复
2. ✅ 已完成: 服务添加到 docker-compose

### 中期 (3-6 个月)
1. 评估 skill-service 合并到 user-service
2. 完善共享实体库 (libs/entities)

### 长期 (6-12 个月)
1. 根据负载情况评估 db-writer-service
2. 根据业务发展决定 content 服务是否合并

## 决策记录

| 日期 | 决策 | 原因 |
|------|------|------|
| 2026-02-20 | 保持 content 服务分离 | 职责边界清晰，便于独立扩展 |
| 2026-02-20 | 保持 skill-service 独立 | 需要评估影响后再决定 |
