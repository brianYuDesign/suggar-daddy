{
  "task": "移除 Sugar-Daddy 專案所有 API 路徑中的 /v1/ 前綴",
  "completed_at": "2026-02-20T15:30:00+08:00",
  "summary": {
    "total_files_modified": 85,
    "total_endpoint_changes": 81,
    "services_updated": 6
  },
  "endpoint_mappings": [
    {
      "service": "Auth Service",
      "old_prefix": "/api/v1/auth",
      "new_prefix": "/api/auth",
      "endpoints": [
        { "old": "POST /api/v1/auth/register", "new": "POST /api/auth/register" },
        { "old": "POST /api/v1/auth/login", "new": "POST /api/auth/login" },
        { "old": "POST /api/v1/auth/refresh", "new": "POST /api/auth/refresh" },
        { "old": "POST /api/v1/auth/logout", "new": "POST /api/auth/logout" },
        { "old": "POST /api/v1/auth/validate", "new": "POST /api/auth/validate" },
        { "old": "POST /api/v1/auth/change-password", "new": "POST /api/auth/change-password" },
        { "old": "GET /api/v1/auth/me", "new": "GET /api/auth/me" }
      ]
    },
    {
      "service": "Auth Service",
      "old_prefix": "/api/v1/users",
      "new_prefix": "/api/users",
      "endpoints": [
        { "old": "GET /api/v1/users", "new": "GET /api/users" },
        { "old": "GET /api/v1/users/:id", "new": "GET /api/users/:id" },
        { "old": "PATCH /api/v1/users/profile", "new": "PATCH /api/users/profile" },
        { "old": "POST /api/v1/users/:id/activate", "new": "POST /api/users/:id/activate" },
        { "old": "POST /api/v1/users/:id/deactivate", "new": "POST /api/users/:id/deactivate" },
        { "old": "DELETE /api/v1/users/:id", "new": "DELETE /api/users/:id" }
      ]
    },
    {
      "service": "Auth Service",
      "old_prefix": "/api/v1/roles",
      "new_prefix": "/api/roles",
      "endpoints": [
        { "old": "GET /api/v1/roles", "new": "GET /api/roles" },
        { "old": "POST /api/v1/roles", "new": "POST /api/roles" },
        { "old": "GET /api/v1/roles/:id", "new": "GET /api/roles/:id" },
        { "old": "PATCH /api/v1/roles/:id", "new": "PATCH /api/roles/:id" },
        { "old": "GET /api/v1/roles/:id/permissions", "new": "GET /api/roles/:id/permissions" },
        { "old": "POST /api/v1/roles/:id/permissions", "new": "POST /api/roles/:id/permissions" }
      ]
    },
    {
      "service": "Auth Service",
      "old_prefix": "/api/v1/permissions",
      "new_prefix": "/api/permissions",
      "endpoints": [
        { "old": "GET /api/v1/permissions", "new": "GET /api/permissions" },
        { "old": "POST /api/v1/permissions", "new": "POST /api/permissions" },
        { "old": "GET /api/v1/permissions/:id", "new": "GET /api/permissions/:id" },
        { "old": "GET /api/v1/permissions/me", "new": "GET /api/permissions/me" },
        { "old": "GET /api/v1/permissions/check", "new": "GET /api/permissions/check" }
      ]
    },
    {
      "service": "Content-Streaming Service",
      "old_prefix": "/api/v1/videos",
      "new_prefix": "/api/videos",
      "endpoints": [
        { "old": "GET /api/v1/videos", "new": "GET /api/videos" },
        { "old": "POST /api/v1/videos", "new": "POST /api/videos" },
        { "old": "GET /api/v1/videos/:id", "new": "GET /api/videos/:id" },
        { "old": "PUT /api/v1/videos/:id", "new": "PUT /api/videos/:id" },
        { "old": "DELETE /api/v1/videos/:id", "new": "DELETE /api/videos/:id" },
        { "old": "POST /api/v1/videos/:id/publish", "new": "POST /api/videos/:id/publish" }
      ]
    },
    {
      "service": "Content-Streaming Service",
      "old_prefix": "/api/v1/uploads",
      "new_prefix": "/api/uploads",
      "endpoints": [
        { "old": "POST /api/v1/uploads/initiate", "new": "POST /api/uploads/initiate" },
        { "old": "GET /api/v1/uploads/:sessionId", "new": "GET /api/uploads/:sessionId" },
        { "old": "POST /api/v1/uploads/:sessionId/chunk", "new": "POST /api/uploads/:sessionId/chunk" },
        { "old": "POST /api/v1/uploads/:sessionId/complete", "new": "POST /api/uploads/:sessionId/complete" }
      ]
    },
    {
      "service": "Content-Streaming Service",
      "old_prefix": "/api/v1/streaming",
      "new_prefix": "/api/streaming",
      "endpoints": [
        { "old": "GET /api/v1/streaming/:videoId/playlist", "new": "GET /api/streaming/:videoId/playlist" },
        { "old": "POST /api/v1/streaming/:videoId/quality-switch", "new": "POST /api/streaming/:videoId/quality-switch" },
        { "old": "GET /api/v1/streaming/:videoId/analytics", "new": "GET /api/streaming/:videoId/analytics" }
      ]
    },
    {
      "service": "Content-Streaming Service",
      "old_prefix": "/api/v1/transcoding",
      "new_prefix": "/api/transcoding",
      "endpoints": [
        { "old": "GET /api/v1/transcoding/:jobId/status", "new": "GET /api/transcoding/:jobId/status" },
        { "old": "GET /api/v1/transcoding/:jobId/logs", "new": "GET /api/transcoding/:jobId/logs" }
      ]
    },
    {
      "service": "Content-Streaming Service",
      "old_prefix": "/api/v1/quality",
      "new_prefix": "/api/quality",
      "endpoints": [
        { "old": "GET /api/v1/quality/profiles", "new": "GET /api/quality/profiles" },
        { "old": "GET /api/v1/quality/recommendations", "new": "GET /api/quality/recommendations" }
      ]
    },
    {
      "service": "Payment Service",
      "old_prefix": "/api/v1/payments",
      "new_prefix": "/api/payments",
      "endpoints": [
        { "old": "POST /api/v1/payments/intent", "new": "POST /api/payments/intent" },
        { "old": "POST /api/v1/payments/confirm", "new": "POST /api/payments/confirm" },
        { "old": "POST /api/v1/payments/refund", "new": "POST /api/payments/refund" },
        { "old": "GET /api/v1/payments/:paymentId", "new": "GET /api/payments/:paymentId" },
        { "old": "GET /api/v1/payments/user/:userId", "new": "GET /api/payments/user/:userId" },
        { "old": "POST /api/v1/payments/:paymentId/retry", "new": "POST /api/payments/:paymentId/retry" }
      ]
    },
    {
      "service": "Payment Service",
      "old_prefix": "/api/v1/subscriptions",
      "new_prefix": "/api/subscriptions",
      "endpoints": [
        { "old": "POST /api/v1/subscriptions", "new": "POST /api/subscriptions" },
        { "old": "PATCH /api/v1/subscriptions/:subscriptionId", "new": "PATCH /api/subscriptions/:subscriptionId" },
        { "old": "POST /api/v1/subscriptions/:subscriptionId/cancel", "new": "POST /api/subscriptions/:subscriptionId/cancel" },
        { "old": "POST /api/v1/subscriptions/:subscriptionId/pause", "new": "POST /api/subscriptions/:subscriptionId/pause" },
        { "old": "POST /api/v1/subscriptions/:subscriptionId/resume", "new": "POST /api/subscriptions/:subscriptionId/resume" },
        { "old": "GET /api/v1/subscriptions/:subscriptionId", "new": "GET /api/subscriptions/:subscriptionId" },
        { "old": "GET /api/v1/subscriptions/user/:userId", "new": "GET /api/subscriptions/user/:userId" },
        { "old": "GET /api/v1/subscriptions", "new": "GET /api/subscriptions" }
      ]
    },
    {
      "service": "Payment Service",
      "old_prefix": "/api/v1/invoices",
      "new_prefix": "/api/invoices",
      "endpoints": [
        { "old": "POST /api/v1/invoices", "new": "POST /api/invoices" },
        { "old": "POST /api/v1/invoices/:invoiceId/send", "new": "POST /api/invoices/:invoiceId/send" },
        { "old": "PATCH /api/v1/invoices/:invoiceId/mark-paid", "new": "PATCH /api/invoices/:invoiceId/mark-paid" },
        { "old": "PATCH /api/v1/invoices/:invoiceId/cancel", "new": "PATCH /api/invoices/:invoiceId/cancel" },
        { "old": "GET /api/v1/invoices/:invoiceId", "new": "GET /api/invoices/:invoiceId" },
        { "old": "GET /api/v1/invoices/user/:userId", "new": "GET /api/invoices/user/:userId" }
      ]
    },
    {
      "service": "Payment Service",
      "old_prefix": "/api/v1/webhooks",
      "new_prefix": "/api/webhooks",
      "endpoints": [
        { "old": "POST /api/v1/webhooks/stripe", "new": "POST /api/webhooks/stripe" }
      ]
    },
    {
      "service": "Subscription Service",
      "old_prefix": "/api/v1/subscriptions",
      "new_prefix": "/api/subscriptions",
      "endpoints": [
        { "old": "GET /api/v1/subscriptions/plans", "new": "GET /api/subscriptions/plans" },
        { "old": "GET /api/v1/subscriptions/plans/:planId", "new": "GET /api/subscriptions/plans/:planId" },
        { "old": "POST /api/v1/subscriptions", "new": "POST /api/subscriptions" },
        { "old": "GET /api/v1/subscriptions/:subscriptionId", "new": "GET /api/subscriptions/:subscriptionId" },
        { "old": "GET /api/v1/subscriptions/user/:userId", "new": "GET /api/subscriptions/user/:userId" },
        { "old": "PATCH /api/v1/subscriptions/:subscriptionId", "new": "PATCH /api/subscriptions/:subscriptionId" },
        { "old": "POST /api/v1/subscriptions/:subscriptionId/cancel", "new": "POST /api/subscriptions/:subscriptionId/cancel" },
        { "old": "POST /api/v1/subscriptions/:subscriptionId/pause", "new": "POST /api/subscriptions/:subscriptionId/pause" },
        { "old": "POST /api/v1/subscriptions/:subscriptionId/resume", "new": "POST /api/subscriptions/:subscriptionId/resume" },
        { "old": "GET /api/v1/subscriptions/:subscriptionId/billing-history", "new": "GET /api/subscriptions/:subscriptionId/billing-history" }
      ]
    },
    {
      "service": "Recommendation Service",
      "old_prefix": "/api/v1/recommendations",
      "new_prefix": "/api/recommendations",
      "endpoints": [
        { "old": "GET /api/v1/recommendations/:userId", "new": "GET /api/recommendations/:userId" },
        { "old": "POST /api/v1/recommendations/interactions", "new": "POST /api/recommendations/interactions" },
        { "old": "POST /api/v1/recommendations/refresh/:userId", "new": "POST /api/recommendations/refresh/:userId" },
        { "old": "POST /api/v1/recommendations/update-scores", "new": "POST /api/recommendations/update-scores" },
        { "old": "POST /api/v1/recommendations/clear-cache", "new": "POST /api/recommendations/clear-cache" }
      ]
    },
    {
      "service": "Recommendation Service",
      "old_prefix": "/api/v1/contents",
      "new_prefix": "/api/contents",
      "endpoints": [
        { "old": "GET /api/v1/contents", "new": "GET /api/contents" },
        { "old": "GET /api/v1/contents/:id", "new": "GET /api/contents/:id" },
        { "old": "POST /api/v1/contents", "new": "POST /api/contents" },
        { "old": "PUT /api/v1/contents/:id", "new": "PUT /api/contents/:id" },
        { "old": "POST /api/v1/contents/:id/view", "new": "POST /api/contents/:id/view" },
        { "old": "POST /api/v1/contents/:id/like", "new": "POST /api/contents/:id/like" },
        { "old": "DELETE /api/v1/contents/:id", "new": "DELETE /api/contents/:id" }
      ]
    }
  ],
  "modified_files": {
    "controllers": [
      "auth-service/src/controllers/auth.controller.ts",
      "auth-service/src/controllers/role.controller.ts",
      "auth-service/src/controllers/permission.controller.ts",
      "auth-service/src/controllers/user.controller.ts",
      "payment-service/src/controllers/payment.controller.ts",
      "subscription-service/src/controllers/subscription.controller.ts",
      "content-streaming-service/src/modules/streams/video.controller.ts",
      "content-streaming-service/src/modules/uploads/upload.controller.ts",
      "content-streaming-service/src/modules/transcoding/transcoding.controller.ts",
      "content-streaming-service/src/modules/quality/quality.controller.ts",
      "content-streaming-service/src/modules/streams/streaming.controller.ts",
      "recommendation-service/src/modules/recommendations/recommendation.controller.ts",
      "recommendation-service/src/modules/contents/content.controller.ts"
    ],
    "gateway": [
      "api-gateway/src/main.js",
      "api-gateway/src/routes/proxy.routes.js"
    ],
    "frontend": [
      "frontend/lib/api/client.ts"
    ],
    "documentation": [
      "documentation/api/API_REFERENCE.md",
      "documentation/api/OPENAPI-3.0.yaml",
      "documentation/operations/OPERATIONS_GUIDE.md",
      "documentation/architecture/SYSTEM_ARCHITECTURE.md",
      "documentation/onboarding/QUICKSTART.md"
    ],
    "tests": [
      "e2e-tests/integration.spec.js",
      "recommendation-service/test/integration/recommendation.controller.spec.ts",
      "recommendation-service/test/integration/timeout-retry.spec.ts",
      "recommendation-service/test/integration/error-security.spec.ts",
      "recommendation-service/test/load/concurrent-requests.k6.ts"
    ],
    "scripts": [
      "start-post-launch-monitoring.sh",
      "qa-004-chaos-testing.sh",
      "QA-004-canary-deployment-test.sh"
    ],
    "monitoring": [
      "monitoring/CANARY_DEPLOYMENT.md",
      "monitoring/setup-canary-deployment.sh"
    ],
    "other_docs": [
      "recommendation-service/API.md",
      "recommendation-service/DELIVERY_REPORT.md",
      "recommendation-service/COMPLETION_SUMMARY.md",
      "recommendation-service/TEAM_HANDOFF.md",
      "content-streaming-service/docs/openapi.yaml",
      "content-streaming-service/summary.json",
      "payment-service/docs/openapi.yaml"
    ]
  },
  "notes": [
    "Prometheus 和 Alertmanager 的 /api/v1/ 路徑為第三方服務 API，未進行修改",
    "前端 .next 構建緩存已清除，需要重新構建",
    "所有服務的 @Controller 裝飾器已更新",
    "API Gateway 路由配置已更新"
  ]
}
