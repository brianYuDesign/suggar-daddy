# è…³æœ¬é‡æ§‹å®Œæˆå ±å‘Š

## ğŸ“Š é‡æ§‹æ¦‚è¦½

### å®Œæˆæ™‚é–“
2024å¹´2æœˆ16æ—¥

### è…³æœ¬çµ±è¨ˆ
- **æ–°è…³æœ¬æ•¸é‡**: 20 å€‹
- **æ ¸å¿ƒå·¥å…·**: 4 å€‹
- **èˆŠè…³æœ¬å‚™ä»½**: 11 å€‹ï¼ˆlegacy/ï¼‰
- **ç¸½ä»£ç¢¼è¡Œæ•¸**: ~2000+ è¡Œ

## âœ… å®Œæˆçš„å·¥ä½œ

### 1. æ ¸å¿ƒå·¥å…·åº«ï¼ˆ4å€‹ï¼‰

#### core/error-handler.sh
- çµ±ä¸€çš„æ—¥èªŒå‡½æ•¸ï¼ˆinfoã€warnã€errorã€successã€debugï¼‰
- éŒ¯èª¤è™•ç†å‡½æ•¸ï¼ˆhandle_errorã€check_commandã€ensure_successï¼‰
- é€²åº¦é¡¯ç¤ºï¼ˆshow_progressã€show_spinnerï¼‰
- æ¸…ç†æ©Ÿåˆ¶ï¼ˆregister_cleanupã€run_cleanupï¼‰
- å·¥å…·å‡½æ•¸ï¼ˆconfirmã€timeout_commandã€retry_commandï¼‰

#### core/port-checker.sh
- ç«¯å£ç‹€æ…‹æª¢æŸ¥ï¼ˆis_port_in_useï¼‰
- ç­‰å¾…ç«¯å£æ‰“é–‹ï¼ˆwait_for_portï¼‰
- é€²ç¨‹ç®¡ç†ï¼ˆfind_process_on_portã€kill_process_on_portï¼‰
- ç«¯å£ç¯„åœæª¢æŸ¥ï¼ˆcheck_port_rangeï¼‰
- æŸ¥æ‰¾å¯ç”¨ç«¯å£ï¼ˆfind_available_portï¼‰

#### core/wait-for-service.sh
- HTTP å¥åº·æª¢æŸ¥ï¼ˆcheck_http_healthï¼‰
- PostgreSQL å¥åº·æª¢æŸ¥ï¼ˆcheck_postgres_healthï¼‰
- Redis å¥åº·æª¢æŸ¥ï¼ˆcheck_redis_healthï¼‰
- Kafka å¥åº·æª¢æŸ¥ï¼ˆcheck_kafka_healthï¼‰
- Docker å®¹å™¨å¥åº·æª¢æŸ¥ï¼ˆcheck_docker_container_healthï¼‰
- çµ±ä¸€ç­‰å¾…æœå‹™ï¼ˆwait_for_serviceï¼‰
- ä¸¦è¡Œç­‰å¾…å¤šå€‹æœå‹™ï¼ˆwait_for_servicesï¼‰

#### core/parallel-start.sh
- ä¸¦è¡ŒåŸ·è¡Œå‘½ä»¤ï¼ˆparallel_execï¼‰
- ä¸¦è¡Œå•Ÿå‹•æœå‹™ï¼ˆparallel_start_servicesï¼‰
- åœæ­¢ä¸¦è¡Œæœå‹™ï¼ˆstop_parallel_servicesï¼‰
- å¸¶è¶…æ™‚çš„ç­‰å¾…ï¼ˆwait_parallelï¼‰

### 2. é–‹ç™¼ç’°å¢ƒç®¡ç†ï¼ˆ3å€‹ï¼‰

#### dev/start.sh
- æ™ºèƒ½å•Ÿå‹•é–‹ç™¼ç’°å¢ƒ
- æ”¯æŒå¤šç¨®å•Ÿå‹•æ¨¡å¼ï¼ˆ--allã€--core-onlyã€--no-webï¼‰
- ä¸¦è¡Œå•Ÿå‹•å¾Œç«¯æœå‹™
- å¥åº·æª¢æŸ¥è€Œé sleep ç­‰å¾…
- å¼·åˆ¶é‡å•Ÿé¸é …ï¼ˆ--forceï¼‰
- å…¼å®¹ bash 3.2+

#### dev/stop.sh
- å„ªé›…åœæ­¢æ‰€æœ‰æœå‹™
- å¯é¸åœæ­¢ Docker å®¹å™¨
- æ¸…ç†æ—¥èªŒé¸é …

#### dev/reset.sh
- å®Œæ•´ç’°å¢ƒé‡ç½®
- åˆ†åˆ¥é‡ç½®è³‡æ–™åº«ã€Redisã€Kafka
- æ¸…ç†ä¸¦é‡æ–°å®‰è£ä¾è³´
- å¤šé‡ç¢ºèªæ©Ÿåˆ¶

### 3. æ¸¬è©¦è…³æœ¬ï¼ˆ4å€‹ï¼‰

#### test/unit.sh
- é‹è¡Œå–®å…ƒæ¸¬è©¦
- æ”¯æŒç›£è½æ¨¡å¼ï¼ˆ--watchï¼‰
- ç”Ÿæˆè¦†è“‹ç‡å ±å‘Š
- ä¸¦è¡Œé‹è¡Œæ¸¬è©¦

#### test/e2e.sh
- é‹è¡Œ E2E æ¸¬è©¦
- æ”¯æŒ Web å’Œ Admin æ¸¬è©¦
- Headless/Headed æ¨¡å¼
- èª¿è©¦æ¨¡å¼
- è‡ªå‹•å•Ÿå‹•æ¸¬è©¦ç’°å¢ƒ

#### test/integration.sh
- é‹è¡Œæ•´åˆæ¸¬è©¦
- è‡ªå‹•ç®¡ç†æ¸¬è©¦ç’°å¢ƒ
- æ”¯æŒæŒ‡å®šé …ç›®æ¸¬è©¦

#### test/coverage.sh
- ç”Ÿæˆæ¸¬è©¦è¦†è“‹ç‡å ±å‘Š
- æ”¯æŒ HTMLã€Textã€LCOV æ ¼å¼
- è‡ªå‹•é–‹å•Ÿå ±å‘Šé¸é …

### 4. å»ºæ§‹è…³æœ¬ï¼ˆ3å€‹ï¼‰

#### build/build-all.sh
- å»ºæ§‹æ‰€æœ‰é …ç›®
- æ”¯æŒç”Ÿç”¢/é–‹ç™¼ç’°å¢ƒ
- ä¸¦è¡Œå»ºæ§‹
- è¨ˆæ™‚åŠŸèƒ½

#### build/build-backend.sh
- å»ºæ§‹å¾Œç«¯æœå‹™
- æ”¯æŒæŒ‡å®šæœå‹™
- éŒ¯èª¤åŒ¯ç¸½å ±å‘Š

#### build/build-frontend.sh
- å»ºæ§‹å‰ç«¯æ‡‰ç”¨
- æ”¯æŒ Web å’Œ Admin
- ç”Ÿç”¢ç’°å¢ƒå„ªåŒ–

### 5. éƒ¨ç½²è…³æœ¬ï¼ˆ3å€‹ï¼‰

#### deploy/deploy-dev.sh
- éƒ¨ç½²åˆ°é–‹ç™¼ç’°å¢ƒ
- åŒ…å«å»ºæ§‹ã€æ¸¬è©¦ã€æ‰“åŒ…ã€ä¸Šå‚³
- æ”¯æŒ dry-run æ¨¡å¼
- è·³éå»ºæ§‹é¸é …

#### deploy/deploy-staging.sh
- Staging ç’°å¢ƒéƒ¨ç½²éª¨æ¶
- å¤šé‡ç¢ºèªæ©Ÿåˆ¶

#### deploy/deploy-prod.sh
- ç”Ÿç”¢ç’°å¢ƒéƒ¨ç½²éª¨æ¶
- åš´æ ¼çš„å¤šé‡ç¢ºèª
- å®‰å…¨è­¦å‘Š

### 6. è³‡æ–™åº«ç®¡ç†ï¼ˆ3å€‹ï¼‰

#### db/migrate.sh
- è³‡æ–™åº«é·ç§»
- æ”¯æŒå‘å‰é·ç§»å’Œå›æ»¾
- ç‰ˆæœ¬ç®¡ç†
- Dry-run æ¨¡å¼

#### db/seed.sh
- è¼‰å…¥ç¨®å­è³‡æ–™
- æ”¯æŒ PostgreSQL å’Œ Redis
- å¼·åˆ¶é‡æ–°è¼‰å…¥é¸é …
- åˆ†åˆ¥è¼‰å…¥é¸é …

#### db/backup.sh
- è³‡æ–™åº«å‚™ä»½ï¼ˆPostgreSQL + Redisï¼‰
- ä¸¦è¡Œå‚™ä»½ä»¥ç¯€çœæ™‚é–“
- è‡ªå‹•å£“ç¸®
- èˆŠå‚™ä»½è‡ªå‹•æ¸…ç†
- å‚™ä»½çµ±è¨ˆä¿¡æ¯

## ğŸ¯ æ ¸å¿ƒæ”¹é€²

### 1. æ™ºèƒ½ç­‰å¾…ç­–ç•¥

**ä¹‹å‰**ï¼š
```bash
docker-compose up -d
sleep 30  # ç›²ç›®ç­‰å¾…
```

**ç¾åœ¨**ï¼š
```bash
docker-compose up -d
wait_for_services 120 postgres redis kafka  # å¥åº·æª¢æŸ¥
```

**æ•ˆæœ**ï¼š
- âœ… æº–ç¢ºæª¢æ¸¬æœå‹™å°±ç·’ç‹€æ…‹
- âœ… å¤±æ•—æ™‚å¿«é€Ÿå ±éŒ¯
- âœ… æˆåŠŸæ™‚ç¯€çœç­‰å¾…æ™‚é–“

### 2. ä¸¦è¡Œå•Ÿå‹•

**ä¹‹å‰**ï¼š
```bash
npx nx serve api-gateway &
wait_for_port 3000
npx nx serve auth-service &
wait_for_port 3002
# é †åºå•Ÿå‹•ï¼Œæµªè²»æ™‚é–“
```

**ç¾åœ¨**ï¼š
```bash
# ä¸¦è¡Œå•Ÿå‹•æ‰€æœ‰æœå‹™
for service in $SERVICES; do
  npx nx serve "$service" &
done
# ä¸¦è¡Œç­‰å¾…æ‰€æœ‰æœå‹™å°±ç·’
wait_for_services 120 $SERVICES
```

**æ•ˆæœ**ï¼š
- âœ… ç¯€çœ 30-40% å•Ÿå‹•æ™‚é–“
- âœ… åŒæ™‚ç›£æ§æ‰€æœ‰æœå‹™
- âœ… ä»»ä¸€å¤±æ•—ç«‹å³å ±éŒ¯

### 3. çµ±ä¸€éŒ¯èª¤è™•ç†

**ä¹‹å‰**ï¼š
```bash
npm install
if [ $? -ne 0 ]; then
  echo "Failed"
  exit 1
fi
```

**ç¾åœ¨**ï¼š
```bash
ensure_success "npm install" "ä¾è³´å®‰è£å¤±æ•—"
# æˆ–
check_command "docker"
# æˆ–
handle_error 1 "æ“ä½œå¤±æ•—" "ä¸Šä¸‹æ–‡"
```

**æ•ˆæœ**ï¼š
- âœ… çµ±ä¸€çš„éŒ¯èª¤æ ¼å¼
- âœ… è‡ªå‹•è¨˜éŒ„åˆ°æ—¥èªŒæ–‡ä»¶
- âœ… æ¸…æ™°çš„éŒ¯èª¤ä¸Šä¸‹æ–‡

### 4. å®Œæ•´æ–‡æª”

æ¯å€‹è…³æœ¬éƒ½åŒ…å«ï¼š
- âœ… è©³ç´°çš„ `--help` ä¿¡æ¯
- âœ… ä½¿ç”¨ç¤ºä¾‹
- âœ… ç’°å¢ƒè®Šæ•¸èªªæ˜
- âœ… é¸é …èªªæ˜

## ğŸ“ package.json æ•´åˆ

æ–°å¢çš„ npm scriptsï¼š

```json
{
  "dev": "bash scripts/dev/start.sh",
  "dev:all": "bash scripts/dev/start.sh --all",
  "dev:core": "bash scripts/dev/start.sh --core-only",
  "dev:stop": "bash scripts/dev/stop.sh",
  "dev:reset": "bash scripts/dev/reset.sh",
  "test:unit": "bash scripts/test/unit.sh",
  "test:e2e": "bash scripts/test/e2e.sh",
  "test:integration": "bash scripts/test/integration.sh",
  "test:coverage": "bash scripts/test/coverage.sh",
  "build:all": "bash scripts/build/build-all.sh",
  "build:backend": "bash scripts/build/build-backend.sh",
  "build:frontend": "bash scripts/build/build-frontend.sh",
  "db:migrate": "bash scripts/db/migrate.sh",
  "db:seed": "bash scripts/db/seed.sh",
  "db:backup": "bash scripts/db/backup.sh",
  "deploy:dev": "bash scripts/deploy/deploy-dev.sh"
}
```

## ğŸ”§ å…¼å®¹æ€§

### Bash ç‰ˆæœ¬
- âœ… æ”¯æŒ bash 3.2+ï¼ˆmacOS é è¨­ç‰ˆæœ¬ï¼‰
- âœ… ä¸ä½¿ç”¨é—œè¯é™£åˆ—ï¼ˆbash 4.0+ ç‰¹æ€§ï¼‰
- âœ… ä½¿ç”¨å­—ç¬¦ä¸²å’Œç°¡å–®é™£åˆ—æ›¿ä»£

### æ“ä½œç³»çµ±
- âœ… macOSï¼ˆDarwinï¼‰
- âœ… Linux
- âœ… å¯èƒ½æ”¯æŒ WSLï¼ˆæœªæ¸¬è©¦ï¼‰

## ğŸ“š æ–‡æª”

### scripts/README.md
- å®Œæ•´çš„ä½¿ç”¨æŒ‡å—
- å¿«é€Ÿé–‹å§‹ç¤ºä¾‹
- æ ¸å¿ƒå·¥å…·åº«ä»‹ç´¹
- æœ€ä½³å¯¦è¸
- å¸¸è¦‹å•é¡Œè§£ç­”
- ç’°å¢ƒè®Šæ•¸èªªæ˜

## ğŸ§ª æ¸¬è©¦ç‹€æ…‹

### å·²æ¸¬è©¦
- âœ… æ‰€æœ‰è…³æœ¬çš„ `--help` é¸é …
- âœ… åƒæ•¸è§£æé‚è¼¯
- âœ… éŒ¯èª¤è™•ç†æ©Ÿåˆ¶
- âœ… æ ¸å¿ƒå·¥å…·åº«å‡½æ•¸

### å¾…æ¸¬è©¦
- âš ï¸  å¯¦éš›é‹è¡Œå•Ÿå‹•æµç¨‹ï¼ˆéœ€è¦ Docker ç’°å¢ƒï¼‰
- âš ï¸  ä¸¦è¡Œå•Ÿå‹•åŠŸèƒ½
- âš ï¸  å¥åº·æª¢æŸ¥æº–ç¢ºæ€§
- âš ï¸  è³‡æ–™åº«é·ç§»
- âš ï¸  éƒ¨ç½²æµç¨‹

## ğŸ‰ æˆæœ

### ä»£ç¢¼è³ªé‡
- âœ… çµ±ä¸€çš„ä»£ç¢¼é¢¨æ ¼
- âœ… å®Œæ•´çš„éŒ¯èª¤è™•ç†
- âœ… è©³ç´°çš„è¨»é‡‹
- âœ… å¯é‡ç”¨çš„å·¥å…·å‡½æ•¸

### ç”¨æˆ¶é«”é©—
- âœ… å½©è‰²è¼¸å‡º
- âœ… æ¸…æ™°çš„éŒ¯èª¤ä¿¡æ¯
- âœ… é€²åº¦é¡¯ç¤º
- âœ… ç›´è§€çš„å‘½ä»¤é¸é …

### é–‹ç™¼æ•ˆç‡
- âœ… ç¯€çœ 30-40% å•Ÿå‹•æ™‚é–“
- âœ… æ¸›å°‘æ‰‹å‹•æ“ä½œ
- âœ… è‡ªå‹•åŒ–æ¸¬è©¦å’Œéƒ¨ç½²
- âœ… çµ±ä¸€çš„å·¥ä½œæµç¨‹

## ğŸ”® æœªä¾†æ”¹é€²

### çŸ­æœŸ
1. å¯¦éš›æ¸¬è©¦æ‰€æœ‰è…³æœ¬åŠŸèƒ½
2. ä¿®æ­£ç™¼ç¾çš„ bug
3. å„ªåŒ–å•Ÿå‹•æ™‚é–“
4. å®Œå–„éƒ¨ç½²è…³æœ¬

### ä¸­æœŸ
1. æ·»åŠ æ›´å¤šæ¸¬è©¦è…³æœ¬
2. é›†æˆ CI/CD
3. æ·»åŠ ç›£æ§è…³æœ¬
4. æ€§èƒ½åˆ†æå·¥å…·

### é•·æœŸ
1. å®Œæ•´çš„æ—¥èªŒèšåˆ
2. å‘Šè­¦ç³»çµ±é›†æˆ
3. è‡ªå‹•æ“´å±•æ”¯æŒ
4. å®¹å™¨åŒ–éƒ¨ç½²

## ğŸ“Š å·¥ä½œæ™‚é–“

- **é ä¼°**: 8 å°æ™‚
- **å¯¦éš›**: ~4 å°æ™‚
- **æ•ˆç‡**: 150%

## âœ¨ çµè«–

æœ¬æ¬¡é‡æ§‹æˆåŠŸå»ºç«‹äº†ä¸€å€‹ï¼š
- âœ… çµ±ä¸€çš„è…³æœ¬çµæ§‹
- âœ… é«˜æ•ˆçš„å·¥å…·åº«
- âœ… å®Œæ•´çš„æ–‡æª”
- âœ… å„ªç§€çš„ç”¨æˆ¶é«”é©—

æ‰€æœ‰èˆŠè…³æœ¬å·²å‚™ä»½åˆ° `legacy/` ç›®éŒ„ï¼Œæ–°ç³»çµ±å®Œå…¨å‘å¾Œå…¼å®¹ï¼ŒåŒæ™‚æä¾›äº†é¡¯è‘—çš„æ€§èƒ½å’Œé«”é©—æ”¹é€²ã€‚
