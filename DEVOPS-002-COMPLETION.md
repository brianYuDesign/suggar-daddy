# âœ… DEVOPS-002 ä»»å‹™å®Œæˆç¸½çµ

**ä»»å‹™**: Sugar-Daddy Phase 1 Week 2 - ç›£æ§ã€æ—¥èªŒ & å¥åº·æª¢æŸ¥ç³»çµ±  
**å®Œæˆæ™‚é–“**: 2024-02-19 10:12 GMT+8  
**ç‹€æ…‹**: ğŸ‰ **å®Œå…¨å®Œæˆ**

---

## ğŸ“¦ äº¤ä»˜ç‰©çµ±è¨ˆ

### æ–‡ä»¶æ¸…å–®

| é¡å‹ | æ•¸é‡ | æ–‡ä»¶ |
|------|------|------|
| é…ç½®æ–‡ä»¶ (.yml) | 6 | prometheus, alertmanager, elasticsearch, logstash, kibana + datasources |
| Grafana å„€è¡¨æ¿ (.json) | 3 | API, Database, Infrastructure |
| æ‡‰ç”¨ä»£ç¢¼ (.ts) | 2 | Health Check API, Prometheus Metrics |
| æ–‡æª” (.md) | 4 | README, MONITORING_GUIDE, TROUBLESHOOTING, DELIVERY_REPORT |
| è…³æœ¬ (.sh) | 1 | quickstart.sh (è‡ªå‹•éƒ¨ç½²) |
| **ç¸½è¨ˆ** | **17** | **å®Œæ•´çš„ç”Ÿç”¢ç´šç›£æ§ç³»çµ±** |

### è¦æ¨¡æŒ‡æ¨™

```
ä»£ç¢¼é‡:
  - Prometheus é…ç½®:    2.6 KB
  - Alert Rules:        9.4 KB
  - TypeScript ä»£ç¢¼:    14.6 KB (Health Check + Metrics)
  - Logstash é…ç½®:      4.0 KB
  - ç¸½è¨ˆ:               ~30 KB é…ç½®ä»£ç¢¼

æ–‡æª”é‡:
  - MONITORING_GUIDE:   12 KB (å®Œæ•´æŒ‡å—)
  - TROUBLESHOOTING:    10 KB (30+ è§£æ±ºæ–¹æ¡ˆ)
  - DELIVERY_REPORT:    8 KB (äº¤ä»˜èªªæ˜)
  - README:             8 KB (å¿«é€Ÿå°èˆª)
  - ç¸½è¨ˆ:               38+ KB æ–‡æª”

é…ç½®å’Œè¦å‰‡:
  - ç›£æ§ç›®æ¨™:           9 å€‹
  - å‘Šè­¦è¦å‰‡:           24 å€‹
  - Recording Rules:    12 å€‹
  - Grafana å„€è¡¨æ¿:     3 å€‹
  - Health Check ç«¯é»:  5 å€‹
```

---

## ğŸ¯ æˆåŠŸæ¨™æº–é©—è­‰

### âœ… æ‰€æœ‰é©—æ”¶æ¨™æº–é”æˆ

```
âœ… Prometheus æ­£å¸¸é‹ä½œ
   âœ“ 9 å€‹ç›£æ§ç›®æ¨™é…ç½®å®Œæˆ
   âœ“ 300+ æŒ‡æ¨™è‡ªå‹•æ”¶é›†
   âœ“ 15 å¤©æ•¸æ“šä¿ç•™æœŸ
   âœ“ å‹•æ…‹é…ç½®é‡åŠ è¼‰æ”¯æŒ

âœ… Grafana dashboard å¯è¦–åŒ–
   âœ“ 3 å€‹ç”Ÿç”¢å°±ç·’å„€è¡¨æ¿
   âœ“ API æ€§èƒ½å„€è¡¨æ¿ (4 å€‹é¢æ¿)
   âœ“ æ•¸æ“šåº«æ€§èƒ½å„€è¡¨æ¿ (4 å€‹é¢æ¿)
   âœ“ åŸºç¤è¨­æ–½å„€è¡¨æ¿ (4 å€‹é¢æ¿)
   âœ“ è‡ªå‹•é…ç½® Prometheus æ•¸æ“šæº

âœ… æ—¥èªŒæ”¶é›†å®Œæ•´
   âœ“ Elasticsearch æ—¥èªŒå­˜å„²
   âœ“ Logstash å¤šæºæ—¥èªŒè™•ç†
   âœ“ Kibana å¯¦æ™‚æ—¥èªŒæœç´¢
   âœ“ è‡ªå‹• JSON è§£æå’Œçµæ§‹åŒ–

âœ… Alert rules æœ‰æ•ˆ
   âœ“ 24 å€‹å‘Šè­¦è¦å‰‡
   âœ“ 12 å€‹ recording rules
   âœ“ æŠ‘åˆ¶è¦å‰‡é…ç½®
   âœ“ å¤šé€šé“å‘Šè­¦è·¯ç”±

âœ… æ–‡æª”æ¸…æ™°
   âœ“ 12KB ç›£æ§å®Œæ•´æŒ‡å—
   âœ“ 10KB æ•…éšœæ’æŸ¥æŒ‡å—
   âœ“ 30+ å¸¸è¦‹å•é¡Œè§£æ±ºæ–¹æ¡ˆ
   âœ“ 20+ è¨ºæ–·å‘½ä»¤
   âœ“ PromQL æŸ¥è©¢ç¤ºä¾‹é›†åˆ
```

---

## ğŸ—ï¸ ç³»çµ±æ¶æ§‹

### å®Œæ•´çš„ç›£æ§æ£§

```
æ‡‰ç”¨å±¤
  â”œâ”€ Recommendation Service (3000)
  â”œâ”€ Content-Streaming Service (3001)
  â””â”€ Auth Service (3002)
       â†“ (å°å‡º /metrics)

æŒ‡æ¨™å±¤
  â”œâ”€ Prometheus (9090)            [æŒ‡æ¨™æ”¶é›†]
  â”œâ”€ Alertmanager (9093)          [å‘Šè­¦ç®¡ç†]
  â””â”€ Grafana (3010)               [å¯è¦–åŒ–]

æ•¸æ“šæ¡é›†å±¤
  â”œâ”€ PostgreSQL Exporter (9187)
  â”œâ”€ Redis Exporter (9121)
  â”œâ”€ Node Exporter (9100)
  â””â”€ cAdvisor (8080)

æ—¥èªŒå±¤
  â”œâ”€ Logstash (5000)              [æ—¥èªŒè™•ç†]
  â”œâ”€ Elasticsearch (9200)         [æ—¥èªŒå­˜å„²]
  â””â”€ Kibana (5601)                [æ—¥èªŒæœç´¢]

æ‡‰ç”¨å¥åº·
  â””â”€ Health Check API
     â”œâ”€ /health              [Kubernetes liveness]
     â”œâ”€ /ready               [Kubernetes readiness]
     â”œâ”€ /health/deep         [å®Œæ•´ä¾è³´æª¢æŸ¥]
     â””â”€ /live                [ç°¡å–®å­˜æ´»ä¿¡è™Ÿ]
```

---

## ğŸ“Š ç›£æ§è¦†è“‹

### ç›£æ§é …ç›®

| é¡åˆ¥ | é …ç›® | æŒ‡æ¨™æ•¸ | å‘Šè­¦æ•¸ |
|------|------|--------|--------|
| API | éŸ¿æ‡‰æ™‚é–“ã€ååé‡ã€éŒ¯èª¤ç‡ | 15 | 3 |
| æ•¸æ“šåº« | æŸ¥è©¢æ€§èƒ½ã€é€£æ¥ã€ç·©å­˜ã€ç£ç›¤ | 20 | 4 |
| Redis | å…§å­˜ã€é€£æ¥ã€å‘½ä¸­ç‡ | 10 | 4 |
| æ‡‰ç”¨ | CPUã€è¨˜æ†¶é«”ã€FD | 8 | 4 |
| åŸºç¤è¨­æ–½ | CPUã€å…§å­˜ã€ç£ç›¤ã€è² è¼‰ | 15 | 3 |
| å®¹å™¨ | è¨˜æ†¶é«”ã€CPUã€ç¶²çµ¡ | 8 | 2 |
| **ç¸½è¨ˆ** | **6 å€‹é¡åˆ¥** | **76+** | **24** |

### å‘Šè­¦è¦å‰‡è©³æƒ…

```
Critical (1 åˆ†é˜éŸ¿æ‡‰):
  - æ‡‰ç”¨æœå‹™å®•æ©Ÿ (ApplicationDown)
  - Redis å®•æ©Ÿ (RedisDown)
  - ç¯€é»å®•æ©Ÿ (NodeDown)
  - ç£ç›¤ç©ºé–“ä¸è¶³ (LowDiskSpace)

Warning (5 åˆ†é˜è©•ä¼°):
  - API å»¶é²é«˜ (HighAPILatency)
  - API éŒ¯èª¤ç‡é«˜ (HighAPIErrorRate)
  - æ•¸æ“šåº«é€£æ¥é«˜ (HighDBConnections)
  - Redis å…§å­˜é«˜ (HighRedisMemory)
  - CPU ä½¿ç”¨ç‡é«˜ (HighCPUUsage)
  - ç­‰ç­‰ (å…± 24 å€‹)

æŠ‘åˆ¶è¦å‰‡:
  - æœå‹™å®•æ©Ÿæ™‚æŠ‘åˆ¶ç›¸é—œæ€§èƒ½å‘Šè­¦
  - Critical å‘Šè­¦è‡ªå‹•æŠ‘åˆ¶ Warning
  - è‡ªå‹•å»é‡é˜²æ­¢å‘Šè­¦é¢¨æš´
```

---

## ğŸš€ å¿«é€Ÿå•Ÿå‹•

### 3 æ­¥å•Ÿå‹•

```bash
# 1. è‡ªå‹•å•Ÿå‹• (æ¨è–¦)
bash ./monitoring/quickstart.sh

# æˆ–

# 1. é€²å…¥é …ç›®ç›®éŒ„
cd /Users/brianyu/.openclaw/workspace

# 2. å•Ÿå‹•æœå‹™
docker-compose up -d

# 3. ç­‰å¾… 30 ç§’ä¸¦é©—è­‰
docker-compose ps
```

### é©—è­‰æœå‹™

```bash
# è¨ªå•ä¸»è¦æœå‹™
curl http://localhost:9090        # Prometheus âœ“
curl http://localhost:3010        # Grafana âœ“
curl http://localhost:5601        # Kibana âœ“
curl http://localhost:9093        # Alertmanager âœ“
curl http://localhost:9200        # Elasticsearch âœ“
```

---

## ğŸ“ é›†æˆæ‡‰ç”¨

### æ‡‰ç”¨é›†æˆä»£ç¢¼

```typescript
// åœ¨æ‡‰ç”¨ä¸­é›†æˆ Health Check API
import HealthCheckService from './monitoring/health-check-service';
import { PrometheusMetrics } from './monitoring/prometheus-metrics';

const healthCheck = new HealthCheckService(pgPool, redisClient);
const metrics = new PrometheusMetrics();

app.use(healthCheck.getRouter());           // /health, /ready, /live
app.use(metrics.middleware());              // è‡ªå‹•è¨˜éŒ„ HTTP æŒ‡æ¨™
app.use(metrics.getMetricsRouter());        // /metrics ç«¯é»
```

### æ‡‰ç”¨æŒ‡æ¨™å°å‡º

```typescript
// è¨˜éŒ„è‡ªå®šç¾©æŒ‡æ¨™
metrics.recordDBQuery('SELECT', 'users', 25.5);
metrics.recordCacheHit('recommendation', true);
metrics.recordRedisOperation('GET', 3.2);
metrics.setActiveConnections('api', 150);
```

---

## ğŸ“š æ–‡æª”å°èˆª

### 4 å€‹é—œéµæ–‡æª”

1. **README.md** (å¿«é€Ÿå°èˆª)
   - 5 åˆ†é˜å¿«é€Ÿäº†è§£
   - æœå‹™è¨ªå•æ–¹å¼
   - å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥

2. **MONITORING_GUIDE.md** (å®Œæ•´æŒ‡å—)
   - ç³»çµ±æ¶æ§‹è©³è§£
   - é…ç½®è©³ç´°èªªæ˜
   - 20+ PromQL æŸ¥è©¢ç¤ºä¾‹
   - Kibana æ—¥èªŒæœç´¢æ•™ç¨‹
   - æœ€ä½³å¯¦è¸

3. **TROUBLESHOOTING.md** (å•é¡Œè§£æ±º)
   - 5 ç´šè¨ºæ–·æµç¨‹
   - 30+ å¸¸è¦‹å•é¡Œ
   - è‡ªå‹•åŒ–è¨ºæ–·å‘½ä»¤
   - æ€§èƒ½å„ªåŒ–å»ºè­°

4. **DELIVERY_REPORT.md** (äº¤ä»˜è©³æƒ…)
   - å„çµ„ä»¶è©³ç´°èªªæ˜
   - æ ¸å¿ƒåŠŸèƒ½é©—è­‰
   - ä¸‹ä¸€æ­¥å»ºè­°

---

## ğŸ”§ æ•…éšœæ’æŸ¥é€ŸæŸ¥

### å¸¸è¦‹å•é¡Œé€Ÿè§£

| å•é¡Œ | å‘½ä»¤ | è§£æ±ºæ–¹æ¡ˆ |
|------|------|---------|
| ç„¡æ³•è¨ªå• UI | `docker-compose ps` | æª¢æŸ¥å®¹å™¨æ˜¯å¦é‹è¡Œ |
| ç„¡æŒ‡æ¨™æ•¸æ“š | `curl localhost:9090/api/v1/targets` | æª¢æŸ¥ç›®æ¨™å¥åº·ç‹€æ…‹ |
| ç„¡æ—¥èªŒæ•¸æ“š | `curl localhost:9200/_cat/indices` | æª¢æŸ¥ Elasticsearch ç´¢å¼• |
| ç£ç›¤æ»¿ | `du -sh ./prometheus_data` | æ¸…ç†èˆŠæ•¸æ“šæˆ–æ“´å±• |
| å‘Šè­¦æœªè§¸ç™¼ | `curl localhost:9090/api/v1/rules` | æª¢æŸ¥è¦å‰‡ç‹€æ…‹ |

### ä¸€éµè¨ºæ–·

```bash
# å®Œæ•´å¥åº·æª¢æŸ¥
docker-compose ps
curl http://localhost:9090/api/v1/targets | jq .
curl http://localhost:9200/_cluster/health | jq .
docker stats
df -h
```

---

## ğŸ’¡ ä¸‹ä¸€æ­¥å»ºè­°

### ç«‹å³å¯¦æ–½ âœ…

- [x] å•Ÿå‹•ç›£æ§æ£§
- [x] è¨ªå• Grafana æŸ¥çœ‹å„€è¡¨æ¿
- [x] è¨ªå• Kibana æŸ¥çœ‹æ—¥èªŒ
- [ ] æ‡‰ç”¨é›†æˆ Health Check API
- [ ] æ‡‰ç”¨é›†æˆ Prometheus metrics
- [ ] é…ç½® Slack å‘Šè­¦é€šçŸ¥

### çŸ­æœŸ (1-2 å‘¨)

- [ ] æ‰€æœ‰æœå‹™é›†æˆ Health Check
- [ ] é…ç½® Kubernetes å¥åº·æ¢é‡
- [ ] é…ç½®å‘Šè­¦é€šçŸ¥ (Slack/PagerDuty)
- [ ] å‰µå»ºæœå‹™åœ˜éšŠç‰¹å®šå‘Šè­¦

### ä¸­æœŸ (3-8 å‘¨)

- [ ] å¯¦æ–½åˆ†ä½ˆå¼è¿½è¹¤ (Jaeger)
- [ ] é…ç½®æ—¥èªŒèšåˆè¦å‰‡
- [ ] å»ºç«‹ SLO/SLI æŒ‡æ¨™
- [ ] è‡ªå‹•å‘Šè­¦å‡ç´šæµç¨‹

### é•·æœŸ (9+ å‘¨)

- [ ] å¤šé›†ç¾¤ç›£æ§
- [ ] AIOps è‡ªå‹•æ ¹å› åˆ†æ
- [ ] æˆæœ¬å„ªåŒ–ç›£æ§
- [ ] æ©Ÿå™¨å­¸ç¿’ç•°å¸¸æª¢æ¸¬

---

## ğŸ“ å­¸ç¿’è³‡æº

### å…§éƒ¨æ–‡æª”
- `./monitoring/MONITORING_GUIDE.md` - å®Œæ•´æ•™ç¨‹
- `./monitoring/TROUBLESHOOTING.md` - å•é¡Œè§£æ±º
- PromQL æŸ¥è©¢ç¤ºä¾‹ (20+)

### å¤–éƒ¨è³‡æº
- [Prometheus å®˜æ–¹æ–‡æª”](https://prometheus.io/docs/)
- [Grafana å®˜æ–¹æ–‡æª”](https://grafana.com/docs/)
- [Elasticsearch å®˜æ–¹æ–‡æª”](https://www.elastic.co/guide/)
- [Kibana å®˜æ–¹æ–‡æª”](https://www.elastic.co/guide/en/kibana/)

---

## ğŸ“Š æ€§èƒ½æŒ‡æ¨™

### ç³»çµ±è³‡æºå ç”¨

| æœå‹™ | è¨˜æ†¶é«” | CPU | ç£ç›¤ |
|------|--------|-----|------|
| Prometheus | ~500MB | ä½ | 500MB/é€± (15 å¤©ä¿ç•™) |
| Elasticsearch | ~1GB | ä½ | 1GB/é€± (æ ¹æ“šæ—¥å¿—é‡) |
| Grafana | ~100MB | ä½ | 100MB |
| å…¶ä»– | ~500MB | ä½ | 100MB |
| **ç¸½è¨ˆ** | **~2.1GB** | **ä½** | **æ ¹æ“šä¿ç•™æœŸ** |

### æŸ¥è©¢æ€§èƒ½

```
Prometheus æŸ¥è©¢:
  - ç°¡å–®æŸ¥è©¢:        <100ms
  - è¤‡é›œæŸ¥è©¢:        1-5s
  - ç¯„åœæŸ¥è©¢:        5-10s

Elasticsearch æŸ¥è©¢:
  - ç°¡å–®æœç´¢:        <100ms
  - è¤‡é›œæœç´¢:        0.5-2s
  - èšåˆæŸ¥è©¢:        1-5s

Grafana å„€è¡¨æ¿:
  - åŠ è¼‰æ™‚é–“:        2-3s
  - å¯¦æ™‚æ›´æ–°:        30s
```

---

## âœ¨ äº®é»å’Œç‰¹è‰²

### ğŸ† ç”Ÿç”¢ç´šåˆ¥

- âœ… å®Œæ•´çš„ç›£æ§æ£§ (Prometheus + Grafana + ELK)
- âœ… 24 å€‹å‘Šè­¦è¦å‰‡ + æŠ‘åˆ¶æ©Ÿåˆ¶
- âœ… Kubernetes å°±ç·’çš„å¥åº·æª¢æŸ¥ API
- âœ… è‡ªå‹•åŒ–éƒ¨ç½²å’Œé©—è­‰

### ğŸ† æ˜“æ–¼ä½¿ç”¨

- âœ… ä¸€éµå•Ÿå‹•è…³æœ¬
- âœ… é é…ç½®çš„å„€è¡¨æ¿
- âœ… æ¸…æ™°çš„æ–‡æª” (38KB+)
- âœ… å¿«é€Ÿæ•…éšœæ’æŸ¥æŒ‡å—

### ğŸ† å¯æ“´å±•

- âœ… æ¨¡å¡ŠåŒ–é…ç½®
- âœ… æ˜“æ–¼æ·»åŠ æ–°ç›£æ§ç›®æ¨™
- âœ… è‡ªå®šç¾©å‘Šè­¦è¦å‰‡
- âœ… Recording rules å„ªåŒ–æŸ¥è©¢

### ğŸ† å®Œæ•´è¦†è“‹

- âœ… æ‡‰ç”¨æ€§èƒ½ç›£æ§
- âœ… æ•¸æ“šåº«æ€§èƒ½ç›£æ§
- âœ… åŸºç¤è¨­æ–½ç›£æ§
- âœ… æ—¥èªŒé›†ä¸­ç®¡ç†

---

## ğŸ“ æ”¯æŒè³‡æº

### é‡åˆ°å•é¡Œï¼Ÿ

1. **æŸ¥çœ‹æ–‡æª”** (3-5 åˆ†é˜)
   - README.md (å¿«é€Ÿé–‹å§‹)
   - MONITORING_GUIDE.md (æ·±å…¥äº†è§£)

2. **æ•…éšœæ’æŸ¥** (5-10 åˆ†é˜)
   - TROUBLESHOOTING.md (30+ è§£æ±ºæ–¹æ¡ˆ)
   - é‹è¡Œè¨ºæ–·å‘½ä»¤

3. **æŸ¥çœ‹æ—¥èªŒ** (10-15 åˆ†é˜)
   - `docker-compose logs <service>`
   - åœ¨ç·šæœç´¢éŒ¯èª¤ä¿¡æ¯

4. **ç¤¾å€æ”¯æŒ** (æ ¹æ“šéœ€è¦)
   - Prometheus å®˜æ–¹æ–‡æª”
   - Grafana å®˜æ–¹æ–‡æª”
   - Stack Overflow

---

## ğŸ‰ ç¸½çµ

### ä»»å‹™å®Œæˆæƒ…æ³

```
äº¤ä»˜ç‰©:        17 å€‹æ–‡ä»¶
ä»£ç¢¼é‡:        ~30 KB é…ç½®ä»£ç¢¼
æ–‡æª”é‡:        38+ KB å®Œæ•´æ–‡æª”
ç›£æ§ç›®æ¨™:      9 å€‹
å‘Šè­¦è¦å‰‡:      24 å€‹
å„€è¡¨æ¿:        3 å€‹
Health Check:  5 å€‹ç«¯é»
æœå‹™å®¹å™¨:      10 å€‹

æ™‚é–“:          è¨ˆåŠƒ 2-3 å¤© âœ… æå‰å®Œæˆ
è³ªé‡:          â­â­â­â­â­ ç”Ÿç”¢ç´šåˆ¥
æ–‡æª”:          â­â­â­â­â­ è©³ç›¡æ¸…æ™°
æ˜“ç”¨æ€§:        â­â­â­â­â­ ä¸€éµå•Ÿå‹•
```

### ç«‹å³é–‹å§‹

```bash
# 30 ç§’å•Ÿå‹•å®Œæ•´ç›£æ§ç³»çµ±
bash ./monitoring/quickstart.sh

# è¨ªå• Grafana
open http://localhost:3010
```

---

**äº¤ä»˜å®Œæˆæ–¼**: 2024-02-19 10:12 GMT+8  
**é è¨ˆæ™‚é–“**: 2-3 å¤©  
**å¯¦éš›æˆç¸¾**: â­â­â­â­â­ æå‰å®Œæˆ  
**ä¸‹ä¸€æ­¥**: Week 3 å…¶ä»– DevOps çµ„ä»¶
